<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Arcade ‚Äî ChiffTown</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --arcade-dark: #021a0a;
            --arcade-deep: #052e16;
            --arcade-green: #22c55e;
            --arcade-lime: #84cc16;
            --arcade-cyan: #22d3ee;
            --arcade-text: #ecfdf5;
            --arcade-text-dim: rgba(236, 253, 245, 0.55);
        }
        html { scroll-behavior: smooth; }
        body { 
            font-family: 'Inter', sans-serif; 
            background: var(--arcade-dark); 
            color: var(--arcade-text); 
            overflow-x: hidden; 
            min-height: 100vh;
            position: relative;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 2rem; }
        
        /* Arcade background image */
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background: url('/images/venue-arcade.png') center/cover no-repeat fixed;
            opacity: 0.25;
            z-index: -2;
            image-rendering: pixelated;
            filter: contrast(1.2) saturate(1.3);
        }
        
        /* Dark overlay with retro grid */
        body::after {
            content: '';
            position: fixed;
            inset: 0;
            background: 
                repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,0,0,0.05) 2px, rgba(0,0,0,0.05) 4px),
                repeating-linear-gradient(90deg, transparent, transparent 2px, rgba(34,197,94,0.02) 2px, rgba(34,197,94,0.02) 4px),
                linear-gradient(180deg, rgba(2,26,10,0.85) 0%, rgba(5,46,22,0.8) 30%, rgba(6,78,59,0.75) 55%, rgba(5,46,22,0.8) 80%, rgba(2,26,10,0.9) 100%);
            pointer-events: none;
            z-index: -1;
        }
        
        /* Pixel particles animation */
        @keyframes pixelFloat {
            0% { transform: translateY(100vh) scale(1); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 0.5; }
            100% { transform: translateY(-10vh) scale(0.5); opacity: 0; }
        }
        
        .pixel-particles {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }
        
        .pixel-particle {
            position: absolute;
            width: 6px;
            height: 6px;
            background: var(--arcade-green);
            animation: pixelFloat 8s linear infinite;
            opacity: 0.6;
            image-rendering: pixelated;
            box-shadow: 0 0 4px currentColor;
        }
        
        .pixel-particle:nth-child(1) { left: 10%; animation-delay: 0s; background: var(--arcade-green); }
        .pixel-particle:nth-child(2) { left: 25%; animation-delay: -2s; background: var(--arcade-lime); animation-duration: 10s; }
        .pixel-particle:nth-child(3) { left: 40%; animation-delay: -4s; background: var(--arcade-cyan); }
        .pixel-particle:nth-child(4) { left: 55%; animation-delay: -1s; background: var(--arcade-green); animation-duration: 9s; }
        .pixel-particle:nth-child(5) { left: 70%; animation-delay: -3s; background: var(--arcade-lime); }
        .pixel-particle:nth-child(6) { left: 85%; animation-delay: -5s; background: var(--arcade-cyan); animation-duration: 11s; }
        .pixel-particle:nth-child(7) { left: 15%; animation-delay: -6s; background: var(--arcade-green); }
        .pixel-particle:nth-child(8) { left: 60%; animation-delay: -2.5s; background: var(--arcade-lime); animation-duration: 8.5s; }
        
        /* CRT Scanline effect */
        .crt-scanlines {
            position: fixed;
            inset: 0;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.15) 0px,
                transparent 1px,
                transparent 2px,
                rgba(0, 0, 0, 0.15) 3px
            );
            pointer-events: none;
            z-index: 10;
            animation: scanlineMove 8s linear infinite;
        }
        
        @keyframes scanlineMove {
            0% { transform: translateY(0); }
            100% { transform: translateY(4px); }
        }
        
        /* CRT Screen curve and glow */
        .crt-overlay {
            position: fixed;
            inset: 0;
            background: radial-gradient(ellipse at center, transparent 50%, rgba(2,26,10,0.3) 100%);
            pointer-events: none;
            z-index: 9;
        }
        
        /* Glitch effect for headers */
        .arcade-title {
            animation: glitchTitle 8s ease-in-out infinite;
        }
        
        @keyframes glitchTitle {
            0%, 90%, 100% { 
                text-shadow: 0 0 10px rgba(34,197,94,0.4), 0 0 20px rgba(34,197,94,0.2);
            }
            91% {
                text-shadow: -2px 0 0 #ff00ff, 2px 0 0 #00ffff;
                transform: skew(-0.5deg);
            }
            92% {
                text-shadow: 2px 0 0 #ff00ff, -2px 0 0 #00ffff;
                transform: skew(0.5deg);
            }
            93% {
                text-shadow: 0 0 10px rgba(34,197,94,0.4), 0 0 20px rgba(34,197,94,0.2);
                transform: skew(0deg);
            }
        }
        
        /* Retro game sprites floating */
        .retro-sprites {
            position: absolute;
            inset: 0;
            pointer-events: none;
            font-size: 32px;
            opacity: 0.15;
            z-index: 2;
        }
        
        .sprite {
            position: absolute;
            animation: spriteFloat 20s linear infinite;
        }
        
        .sprite:nth-child(1) { left: 5%; top: 10%; animation-delay: 0s; }
        .sprite:nth-child(2) { left: 85%; top: 25%; animation-delay: -5s; animation-duration: 25s; }
        .sprite:nth-child(3) { left: 30%; top: 60%; animation-delay: -10s; animation-duration: 22s; }
        .sprite:nth-child(4) { left: 70%; top: 75%; animation-delay: -15s; animation-duration: 24s; }
        
        @keyframes spriteFloat {
            0% { transform: translateY(0) translateX(0); }
            25% { transform: translateY(-20px) translateX(10px); }
            50% { transform: translateY(-10px) translateX(-15px); }
            75% { transform: translateY(-25px) translateX(5px); }
            100% { transform: translateY(0) translateX(0); }
        }
        
        .navbar { position: fixed; top: 0; left: 0; right: 0; z-index: 1000; padding: 0.75rem 0; background: rgba(2,26,10,0.9); backdrop-filter: blur(20px); border-bottom: 1px solid rgba(34,197,94,0.15); }
        .nav-container { max-width: 1200px; margin: 0 auto; padding: 0 2rem; display: flex; justify-content: space-between; align-items: center; }
        .nav-logo { display: flex; align-items: center; gap: 0.75rem; text-decoration: none; color: var(--arcade-text); }
        .nav-logo img { height: 32px; width: auto; image-rendering: pixelated; }
        .nav-logo span { font-family: 'Press Start 2P', cursive; font-size: 0.85rem; }
        .nav-links { display: flex; gap: 0.5rem; }
        .nav-links a { color: var(--arcade-text-dim); text-decoration: none; font-size: 0.88rem; font-weight: 500; padding: 0.4rem 0.8rem; border-radius: 8px; transition: all 0.2s ease; }
        .nav-links a:hover { color: var(--arcade-text); background: rgba(34,197,94,0.1); }
        
        .back-btn { position: fixed; top: 80px; left: 1.5rem; background: rgba(2,26,10,0.9); backdrop-filter: blur(10px); border: 1px solid rgba(34,197,94,0.2); color: var(--arcade-green); padding: 0.6rem 1rem; border-radius: 50px; cursor: pointer; z-index: 999; transition: all 0.3s ease; font-size: 0.85rem; display: flex; align-items: center; gap: 0.4rem; text-decoration: none; }
        .back-btn:hover { background: rgba(34,197,94,0.1); transform: translateX(-3px); }
        
        .arcade-hero {
            min-height: 50vh; display: flex; align-items: center; justify-content: center; text-align: center;
            position: relative; overflow: hidden;
            background: linear-gradient(180deg, #021a0a 0%, #052e16 30%, #064e3b 55%, #052e16 80%, #021a0a 100%);
        }
        
        .pixel-grid {
            position: absolute; inset: 0;
            background-image: radial-gradient(circle, rgba(34,197,94,0.08) 1px, transparent 1px);
            background-size: 20px 20px; opacity: 0.5;
        }
        
        .game-elements { position: absolute; inset: 0; pointer-events: none; overflow: hidden; }
        .game-el { position: absolute; font-size: 1.5rem; opacity: 0.1; animation: floatGame 10s ease-in-out infinite; }
        .game-el:nth-child(1) { left: 10%; top: 20%; animation-delay: 0s; }
        .game-el:nth-child(2) { left: 80%; top: 30%; animation-delay: -2s; }
        .game-el:nth-child(3) { left: 25%; top: 70%; animation-delay: -4s; }
        .game-el:nth-child(4) { left: 70%; top: 60%; animation-delay: -6s; }
        .game-el:nth-child(5) { left: 45%; top: 15%; animation-delay: -8s; }
        @keyframes floatGame { 0%, 100% { transform: translateY(0) rotate(0deg); opacity: 0.08; } 50% { transform: translateY(-20px) rotate(10deg); opacity: 0.15; } }
        
        .arcade-content { position: relative; z-index: 5; max-width: 650px; padding: 0 2rem; }
        .arcade-badge { display: inline-flex; align-items: center; gap: 0.5rem; background: rgba(34,197,94,0.1); border: 1px solid rgba(34,197,94,0.2); padding: 0.4rem 1rem; border-radius: 50px; font-size: 0.65rem; font-weight: 600; color: var(--arcade-green); margin-bottom: 1.25rem; font-family: 'Press Start 2P', cursive; }
        .arcade-title { font-family: 'Press Start 2P', cursive; font-size: clamp(1.5rem, 4vw, 2.5rem); margin-bottom: 1rem; line-height: 1.4; color: var(--arcade-green); text-shadow: 0 0 20px rgba(34,197,94,0.4), 0 0 40px rgba(34,197,94,0.2); }
        .arcade-subtitle { font-size: 1.1rem; color: var(--arcade-text-dim); margin-bottom: 2rem; line-height: 1.6; }
        
        /* Game Selection Cards */
        .games-section { padding: 3rem 0; background: var(--arcade-dark); }
        .section-header { margin-bottom: 2rem; text-align: center; }
        .section-header h2 { font-family: 'Press Start 2P', cursive; font-size: 1rem; margin-bottom: 0.75rem; color: var(--arcade-green); text-shadow: 0 0 10px rgba(34,197,94,0.3); }
        .section-header p { color: var(--arcade-text-dim); font-size: 0.95rem; }
        
        .games-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; margin-bottom: 3rem; }
        .game-card {
            background: rgba(255,255,255,0.02); border: 1px solid rgba(34,197,94,0.12); border-radius: 16px;
            padding: 2rem; cursor: pointer; transition: all 0.3s ease; text-align: center; position: relative; overflow: hidden;
        }
        .game-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, var(--arcade-green), var(--arcade-cyan)); opacity: 0; transition: opacity 0.3s; }
        .game-card:hover { background: rgba(34,197,94,0.05); border-color: rgba(34,197,94,0.25); transform: translateY(-4px); }
        .game-card:hover::before { opacity: 1; }
        .game-card-icon { font-size: 3rem; margin-bottom: 1rem; }
        .game-card h3 { font-family: 'Press Start 2P', cursive; font-size: 0.8rem; color: var(--arcade-green); margin-bottom: 0.75rem; }
        .game-card p { color: var(--arcade-text-dim); font-size: 0.85rem; line-height: 1.5; }
        .game-card .play-tag { display: inline-block; margin-top: 1rem; background: linear-gradient(135deg, var(--arcade-green), #16a34a); color: #021a0a; font-weight: 700; font-size: 0.75rem; padding: 0.5rem 1.2rem; border-radius: 50px; font-family: 'Press Start 2P', cursive; }
        
        /* Game Area */
        .game-area { display: none; padding: 2rem 0; min-height: 60vh; }
        .game-area.active { display: block; }
        .game-back-btn { background: rgba(34,197,94,0.1); border: 1px solid rgba(34,197,94,0.2); color: var(--arcade-green); padding: 0.5rem 1rem; border-radius: 50px; cursor: pointer; font-size: 0.8rem; margin-bottom: 1.5rem; display: inline-flex; align-items: center; gap: 0.4rem; transition: all 0.2s; }
        .game-back-btn:hover { background: rgba(34,197,94,0.2); }
        .game-status { font-family: 'Press Start 2P', cursive; font-size: 0.7rem; color: var(--arcade-green); text-align: center; margin-bottom: 1.5rem; padding: 0.75rem; background: rgba(34,197,94,0.05); border: 1px solid rgba(34,197,94,0.1); border-radius: 12px; }
        
        /* TTT Board */
        .ttt-board { display: grid; grid-template-columns: repeat(3, 1fr); gap: 6px; max-width: 300px; margin: 0 auto 1.5rem; }
        .ttt-cell {
            aspect-ratio: 1; background: rgba(255,255,255,0.03); border: 1px solid rgba(34,197,94,0.15);
            border-radius: 8px; display: flex; align-items: center; justify-content: center;
            font-family: 'Press Start 2P', cursive; font-size: 2rem; color: var(--arcade-green);
            cursor: pointer; transition: all 0.2s;
        }
        .ttt-cell:hover { background: rgba(34,197,94,0.08); }
        .ttt-cell.x { color: #22d3ee; }
        .ttt-cell.o { color: #ec4899; }
        .ttt-cell.disabled { pointer-events: none; }
        
        /* RPS */
        .rps-choices { display: flex; gap: 1rem; justify-content: center; margin: 1.5rem 0; flex-wrap: wrap; }
        .rps-choice {
            width: 100px; height: 100px; border-radius: 16px; border: 2px solid rgba(34,197,94,0.2);
            background: rgba(255,255,255,0.02); display: flex; flex-direction: column; align-items: center; justify-content: center;
            gap: 0.5rem; cursor: pointer; transition: all 0.3s; font-size: 2.5rem;
        }
        .rps-choice:hover { border-color: var(--arcade-green); background: rgba(34,197,94,0.08); transform: scale(1.05); }
        .rps-choice.selected { border-color: var(--arcade-green); background: rgba(34,197,94,0.15); box-shadow: 0 0 20px rgba(34,197,94,0.3); }
        .rps-choice span { font-size: 0.6rem; font-family: 'Press Start 2P', cursive; color: var(--arcade-text-dim); }
        .rps-vs { display: flex; align-items: center; justify-content: center; gap: 2rem; margin: 1.5rem 0; }
        .rps-player { text-align: center; }
        .rps-player .emoji { font-size: 3rem; }
        .rps-player .name { font-family: 'Press Start 2P', cursive; font-size: 0.6rem; color: var(--arcade-text-dim); margin-top: 0.5rem; }
        .rps-score { font-family: 'Press Start 2P', cursive; font-size: 1.5rem; color: var(--arcade-green); }
        
        /* Trivia */
        .trivia-question-box {
            background: rgba(255,255,255,0.03); border: 1px solid rgba(34,197,94,0.15); border-radius: 16px;
            padding: 2rem; margin-bottom: 1.5rem; text-align: center;
        }
        .trivia-category { font-size: 0.7rem; color: var(--arcade-cyan); font-family: 'Press Start 2P', cursive; margin-bottom: 0.5rem; }
        .trivia-q-text { font-size: 1.1rem; line-height: 1.6; margin-bottom: 1.5rem; }
        .trivia-timer { font-family: 'Press Start 2P', cursive; font-size: 1.5rem; color: var(--arcade-green); margin-bottom: 1rem; }
        .trivia-timer.urgent { color: #ef4444; animation: pulse 0.5s ease infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .trivia-options { display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; max-width: 600px; margin: 0 auto; }
        .trivia-option {
            background: rgba(255,255,255,0.03); border: 1px solid rgba(34,197,94,0.15); border-radius: 12px;
            padding: 1rem; cursor: pointer; transition: all 0.2s; text-align: center; font-size: 0.9rem;
        }
        .trivia-option:hover { border-color: var(--arcade-green); background: rgba(34,197,94,0.08); }
        .trivia-option.correct { border-color: #22c55e; background: rgba(34,197,94,0.2); color: #22c55e; }
        .trivia-option.wrong { border-color: #ef4444; background: rgba(239,68,68,0.1); color: #ef4444; }
        .trivia-option.disabled { pointer-events: none; opacity: 0.6; }
        .trivia-scoreboard { margin-top: 1.5rem; }
        .trivia-score-row { display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 1rem; background: rgba(255,255,255,0.02); border-radius: 8px; margin-bottom: 0.5rem; }
        .trivia-score-row .rank { font-family: 'Press Start 2P', cursive; font-size: 0.7rem; color: var(--arcade-green); }
        .trivia-score-row .name { font-size: 0.9rem; }
        .trivia-score-row .score { font-family: 'Press Start 2P', cursive; font-size: 0.7rem; color: var(--arcade-cyan); }
        .trivia-players { display: flex; gap: 0.5rem; flex-wrap: wrap; justify-content: center; margin: 1rem 0; }
        .trivia-player-tag { background: rgba(34,197,94,0.1); border: 1px solid rgba(34,197,94,0.2); padding: 0.3rem 0.8rem; border-radius: 50px; font-size: 0.75rem; }
        
        /* Rooms section */
        .rooms-section { padding: 3rem 0; border-top: 1px solid rgba(34,197,94,0.08); }
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.25rem; margin-bottom: 3rem; }
        .stat-card { background: rgba(255,255,255,0.02); border: 1px solid rgba(34,197,94,0.1); padding: 1.5rem; border-radius: 16px; text-align: center; transition: all 0.3s ease; }
        .stat-card:hover { background: rgba(34,197,94,0.04); transform: translateY(-3px); }
        .stat-card i { font-size: 1.8rem; color: var(--arcade-green); margin-bottom: 0.75rem; }
        .stat-number { font-size: 1.5rem; font-weight: 700; font-family: 'Press Start 2P', cursive; margin-bottom: 0.25rem; color: var(--arcade-green); }
        .stat-label { color: var(--arcade-text-dim); font-size: 0.85rem; }
        .rooms-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.25rem; }
        .room-card { background: rgba(255,255,255,0.02); border: 1px solid rgba(34,197,94,0.1); border-radius: 16px; padding: 1.5rem; cursor: pointer; transition: all 0.3s ease; position: relative; overflow: hidden; }
        .room-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, var(--arcade-green), var(--arcade-cyan)); opacity: 0; transition: opacity 0.3s; }
        .room-card:hover { background: rgba(34,197,94,0.04); border-color: rgba(34,197,94,0.2); transform: translateY(-4px); }
        .room-card:hover::before { opacity: 1; }
        .room-card-header { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem; }
        .room-card-icon { width: 44px; height: 44px; background: linear-gradient(135deg, var(--arcade-green), #16a34a); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: #021a0a; font-size: 1.2rem; }
        .room-card-title { font-size: 1.1rem; font-weight: 600; }
        .room-card-description { color: var(--arcade-text-dim); font-size: 0.88rem; margin-bottom: 1rem; line-height: 1.5; }
        .room-card-stats { display: flex; justify-content: space-between; padding-top: 0.75rem; border-top: 1px solid rgba(255,255,255,0.04); }
        .room-card-stat { display: flex; align-items: center; gap: 0.4rem; color: var(--arcade-text-dim); font-size: 0.82rem; }
        .room-card-stat .fa-circle.live { color: #4ade80; }
        .empty-state { text-align: center; padding: 3rem 2rem; }
        .empty-state i { font-size: 2.5rem; color: var(--arcade-green); margin-bottom: 1rem; opacity: 0.6; }
        .empty-state h3 { font-family: 'Press Start 2P', cursive; font-size: 0.8rem; margin-bottom: 0.75rem; color: var(--arcade-green); }
        .empty-state p { color: var(--arcade-text-dim); margin-bottom: 1rem; }
        
        .arcade-btn { background: linear-gradient(135deg, var(--arcade-green), #16a34a); color: #021a0a; border: none; padding: 0.75rem 1.5rem; border-radius: 50px; font-weight: 700; font-size: 0.9rem; cursor: pointer; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 0.5rem; font-family: inherit; box-shadow: 0 4px 15px rgba(34,197,94,0.3); }
        .arcade-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 25px rgba(34,197,94,0.4); }
        .arcade-btn.secondary { background: rgba(255,255,255,0.05); border: 1px solid rgba(34,197,94,0.2); box-shadow: none; color: var(--arcade-text); }
        .arcade-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        
        .footer { background: rgba(1,10,4,0.95); border-top: 1px solid rgba(34,197,94,0.08); padding: 3rem 0 1.25rem; }
        .footer-content { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 2rem; margin-bottom: 2rem; }
        .footer-section h3 { font-family: 'Press Start 2P', cursive; font-size: 0.7rem; color: var(--arcade-green); margin-bottom: 0.75rem; }
        .footer-section p, .footer-section a { color: var(--arcade-text-dim); font-size: 0.88rem; text-decoration: none; }
        .footer-section ul { list-style: none; }
        .footer-section li { margin-bottom: 0.4rem; }
        .footer-section a:hover { color: var(--arcade-green); }
        .social-links { display: flex; gap: 0.5rem; }
        .social-links a { width: 36px; height: 36px; border-radius: 10px; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05); display: flex; align-items: center; justify-content: center; color: var(--arcade-text-dim); transition: all 0.3s; }
        .social-links a:hover { background: rgba(34,197,94,0.1); color: var(--arcade-green); }
        .footer-bottom { text-align: center; padding-top: 1.25rem; border-top: 1px solid rgba(255,255,255,0.04); }
        .footer-bottom p { color: rgba(236,253,245,0.3); font-size: 0.8rem; }
        
        @media (max-width: 768px) {
            .arcade-title { font-size: 1.5rem; }
            .games-grid { grid-template-columns: 1fr; }
            .stats-grid { grid-template-columns: 1fr; }
            .rooms-grid { grid-template-columns: 1fr; }
            .trivia-options { grid-template-columns: 1fr; }
            .rps-choices { gap: 0.5rem; }
            .rps-choice { width: 80px; height: 80px; }
        }
    </style>
</head>
<body>
    <!-- CRT Effects -->
    <div class="crt-overlay"></div>
    <div class="crt-scanlines"></div>
    
    <!-- Pixel Particles -->
    <div class="pixel-particles">
        <div class="pixel-particle"></div>
        <div class="pixel-particle"></div>
        <div class="pixel-particle"></div>
        <div class="pixel-particle"></div>
        <div class="pixel-particle"></div>
        <div class="pixel-particle"></div>
        <div class="pixel-particle"></div>
        <div class="pixel-particle"></div>
    </div>
    
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="nav-logo"><img src="/images/chifftown-logo.png" alt="CHIFFTOWN"></a>
            <div class="nav-links"><a href="index.html">Home</a></div>
        </div>
    </nav>
    <a href="index.html" class="back-btn"><i class="fas fa-arrow-left"></i> Town Centre</a>

    <section class="arcade-hero">
        <div class="pixel-grid"></div>
        <div class="retro-sprites">
            <div class="sprite">üëæ</div>
            <div class="sprite">üïπÔ∏è</div>
            <div class="sprite">üéÆ</div>
            <div class="sprite">‚≠ê</div>
        </div>
        <div class="game-elements">
            <div class="game-el">üéÆ</div><div class="game-el">üïπÔ∏è</div><div class="game-el">üëæ</div>
            <div class="game-el">üèÜ</div><div class="game-el">‚≠ê</div>
        </div>
        <div class="arcade-content">
            <div class="arcade-badge"><i class="fas fa-gamepad"></i> PLAYER 1 READY</div>
            <h1 class="arcade-title">THE ARCADE</h1>
            <p class="arcade-subtitle">Challenge friends, compete online, and game on. Pick a game below!</p>
        </div>
    </section>

    <!-- Game Selection -->
    <section class="games-section" id="gameSelect">
        <div class="container">
            <div class="section-header">
                <h2>CHOOSE YOUR GAME</h2>
                <p>Pick a game to play with others online</p>
            </div>
            <div class="games-grid">
                <div class="game-card" onclick="startGame('ttt')">
                    <div class="game-card-icon">‚ùå‚≠ï</div>
                    <h3>TIC TAC TOE</h3>
                    <p>Classic 2-player strategy. Get three in a row to win!</p>
                    <div class="play-tag">PLAY NOW</div>
                </div>
                <div class="game-card" onclick="startGame('rps')">
                    <div class="game-card-icon">‚úä‚úã‚úåÔ∏è</div>
                    <h3>ROCK PAPER SCISSORS</h3>
                    <p>Best of 5 rounds. Quick reflexes win the day!</p>
                    <div class="play-tag">PLAY NOW</div>
                </div>
                <div class="game-card" onclick="startGame('trivia')">
                    <div class="game-card-icon">üß†üí°</div>
                    <h3>TRIVIA QUIZ</h3>
                    <p>10 questions from around the world. Test your knowledge!</p>
                    <div class="play-tag">PLAY NOW</div>
                </div>
            </div>
        </div>
    </section>

    <!-- TIC TAC TOE GAME AREA -->
    <section class="game-area" id="tttArea">
        <div class="container">
            <button class="game-back-btn" onclick="leaveGame('ttt')"><i class="fas fa-arrow-left"></i> Back to Games</button>
            <div class="section-header"><h2>TIC TAC TOE</h2></div>
            <div class="game-status" id="tttStatus">Enter your name to find an opponent...</div>
            <div id="tttNameInput" style="text-align:center;margin-bottom:1.5rem;">
                <input type="text" id="tttName" placeholder="Your name" style="background:rgba(255,255,255,0.05);border:1px solid rgba(34,197,94,0.2);color:var(--arcade-text);padding:0.6rem 1rem;border-radius:8px;font-size:0.9rem;margin-right:0.5rem;">
                <button class="arcade-btn" onclick="findTTTGame()"><i class="fas fa-search"></i> Find Game</button>
            </div>
            <div class="ttt-board" id="tttBoard" style="display:none;">
                <div class="ttt-cell" onclick="tttMove(0)"></div>
                <div class="ttt-cell" onclick="tttMove(1)"></div>
                <div class="ttt-cell" onclick="tttMove(2)"></div>
                <div class="ttt-cell" onclick="tttMove(3)"></div>
                <div class="ttt-cell" onclick="tttMove(4)"></div>
                <div class="ttt-cell" onclick="tttMove(5)"></div>
                <div class="ttt-cell" onclick="tttMove(6)"></div>
                <div class="ttt-cell" onclick="tttMove(7)"></div>
                <div class="ttt-cell" onclick="tttMove(8)"></div>
            </div>
            <div style="text-align:center;margin-top:1rem;">
                <button class="arcade-btn secondary" id="tttPlayAgain" onclick="findTTTGame()" style="display:none;"><i class="fas fa-redo"></i> Play Again</button>
            </div>
        </div>
    </section>

    <!-- RPS GAME AREA -->
    <section class="game-area" id="rpsArea">
        <div class="container">
            <button class="game-back-btn" onclick="leaveGame('rps')"><i class="fas fa-arrow-left"></i> Back to Games</button>
            <div class="section-header"><h2>ROCK PAPER SCISSORS</h2></div>
            <div class="game-status" id="rpsStatus">Enter your name to find an opponent...</div>
            <div id="rpsNameInput" style="text-align:center;margin-bottom:1.5rem;">
                <input type="text" id="rpsName" placeholder="Your name" style="background:rgba(255,255,255,0.05);border:1px solid rgba(34,197,94,0.2);color:var(--arcade-text);padding:0.6rem 1rem;border-radius:8px;font-size:0.9rem;margin-right:0.5rem;">
                <button class="arcade-btn" onclick="findRPSGame()"><i class="fas fa-search"></i> Find Game</button>
            </div>
            <div id="rpsGame" style="display:none;">
                <div class="rps-vs">
                    <div class="rps-player"><div class="emoji" id="rpsP1Emoji">‚ùì</div><div class="name" id="rpsP1Name">Player 1</div></div>
                    <div class="rps-score" id="rpsScoreDisplay">0 - 0</div>
                    <div class="rps-player"><div class="emoji" id="rpsP2Emoji">‚ùì</div><div class="name" id="rpsP2Name">Player 2</div></div>
                </div>
                <div id="rpsRound" style="text-align:center;font-family:'Press Start 2P',cursive;font-size:0.7rem;color:var(--arcade-text-dim);margin-bottom:1rem;">ROUND 1/5</div>
                <div class="rps-choices" id="rpsChoices">
                    <div class="rps-choice" onclick="rpsChoose('rock')">ü™®<span>ROCK</span></div>
                    <div class="rps-choice" onclick="rpsChoose('paper')">üìÑ<span>PAPER</span></div>
                    <div class="rps-choice" onclick="rpsChoose('scissors')">‚úÇÔ∏è<span>SCISSORS</span></div>
                </div>
                <div id="rpsResult" style="text-align:center;margin-top:1rem;font-family:'Press Start 2P',cursive;font-size:0.8rem;color:var(--arcade-green);"></div>
            </div>
            <div style="text-align:center;margin-top:1rem;">
                <button class="arcade-btn secondary" id="rpsPlayAgain" onclick="findRPSGame()" style="display:none;"><i class="fas fa-redo"></i> Play Again</button>
            </div>
        </div>
    </section>

    <!-- TRIVIA GAME AREA -->
    <section class="game-area" id="triviaArea">
        <div class="container">
            <button class="game-back-btn" onclick="leaveGame('trivia')"><i class="fas fa-arrow-left"></i> Back to Games</button>
            <div class="section-header"><h2>TRIVIA QUIZ</h2></div>
            <div class="game-status" id="triviaStatus">Enter your name to join a trivia session...</div>
            <div id="triviaNameInput" style="text-align:center;margin-bottom:1.5rem;">
                <input type="text" id="triviaName" placeholder="Your name" style="background:rgba(255,255,255,0.05);border:1px solid rgba(34,197,94,0.2);color:var(--arcade-text);padding:0.6rem 1rem;border-radius:8px;font-size:0.9rem;margin-right:0.5rem;">
                <button class="arcade-btn" onclick="findTriviaGame()"><i class="fas fa-search"></i> Join Quiz</button>
            </div>
            <div id="triviaLobby" style="display:none;text-align:center;">
                <p style="color:var(--arcade-text-dim);margin-bottom:1rem;">Players in lobby:</p>
                <div class="trivia-players" id="triviaPlayerList"></div>
                <button class="arcade-btn" id="triviaStartBtn" onclick="startTrivia()" style="display:none;margin-top:1rem;"><i class="fas fa-play"></i> Start Quiz</button>
            </div>
            <div id="triviaGame" style="display:none;">
                <div class="trivia-question-box">
                    <div class="trivia-category" id="triviaCategory">Category</div>
                    <div class="trivia-timer" id="triviaTimer">15</div>
                    <div class="trivia-q-text" id="triviaQuestion">Question?</div>
                </div>
                <div class="trivia-options" id="triviaOptions"></div>
            </div>
            <div class="trivia-scoreboard" id="triviaScoreboard" style="display:none;">
                <div class="section-header"><h2 style="font-size:0.8rem;">SCOREBOARD</h2></div>
                <div id="triviaScores"></div>
            </div>
            <div style="text-align:center;margin-top:1rem;">
                <button class="arcade-btn secondary" id="triviaPlayAgain" onclick="findTriviaGame()" style="display:none;"><i class="fas fa-redo"></i> Play Again</button>
            </div>
        </div>
    </section>

    <!-- Video Chat Rooms Section -->
    <section class="rooms-section" id="roomsSection">
        <div class="container">
            <div class="section-header">
                <h2>ARCADE ROOMS</h2>
                <p>Video chat while gaming ‚Äî start or join a room</p>
            </div>
            <div style="display:flex;gap:0.75rem;justify-content:center;margin-bottom:2rem;">
                <button class="arcade-btn" onclick="createRoom()"><i class="fas fa-plus"></i> Start Room</button>
                <button class="arcade-btn secondary" onclick="refreshRooms()"><i class="fas fa-sync-alt"></i> Refresh</button>
            </div>
            <div class="stats-grid">
                <div class="stat-card"><i class="fas fa-users"></i><div class="stat-number" id="totalUsers">0</div><div class="stat-label">Players</div></div>
                <div class="stat-card"><i class="fas fa-gamepad"></i><div class="stat-number" id="activeRooms">0</div><div class="stat-label">Active</div></div>
                <div class="stat-card"><i class="fas fa-trophy"></i><div class="stat-number" id="liveStreams">0</div><div class="stat-label">Live</div></div>
            </div>
            <div id="roomsList" class="rooms-grid"></div>
            <div id="noRooms" class="empty-state">
                <i class="fas fa-gamepad"></i>
                <h3>NO ACTIVE ROOMS</h3>
                <p>Start a video room to game with friends!</p>
                <button class="arcade-btn" onclick="createRoom()"><i class="fas fa-plus"></i> Start Room</button>
            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section"><h3>THE ARCADE</h3><p>ChiffTown's gaming den.</p></div>
                <div class="footer-section"><h3>GAMES</h3><ul><li><a href="#" onclick="startGame('ttt')">Tic Tac Toe</a></li><li><a href="#" onclick="startGame('rps')">Rock Paper Scissors</a></li><li><a href="#" onclick="startGame('trivia')">Trivia Quiz</a></li></ul></div>
                <div class="footer-section"><h3>CONNECT</h3><div class="social-links"><a href="#"><i class="fab fa-twitter"></i></a><a href="#"><i class="fab fa-discord"></i></a></div></div>
            </div>
            <div class="footer-bottom"><p>&copy; 2025 ChiffTown ‚Äî The Arcade</p></div>
        </div>
    </footer>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
        let socket = null, pendingHost = null;
        let currentGameId = null, currentGameType = null;
        let myTTTSymbol = null;
        let triviaTimerInterval = null;
        
        // === SOCKET INIT ===
        function initSocket() {
            const url = ['localhost','127.0.0.1'].includes(location.hostname) ? 'http://localhost:3000' : location.origin;
            socket = io(url, { transports: ['websocket','polling'], timeout: 5000, forceNew: true });
            
            socket.on('connect', () => {
                console.log('‚úÖ Arcade connected');
                socket.emit('get-room-list');
            });
            
            // Room events
            socket.on('room-list', d => {
                const filtered = d.rooms.filter(r => r.type === 'arcade');
                updateRoomList(filtered);
                updateStats(d.stats);
            });
            socket.on('room-created', r => {
                const u = pendingHost || 'Host';
                pendingHost = null;
                setTimeout(() => window.location.href = `pub-stream.html?v=${Date.now()}&room=${r.id}&username=${encodeURIComponent(u)}&host=1&type=arcade`, 400);
            });
            socket.on('room-updated', () => socket.emit('get-room-list'));
            
            // === TTT Events ===
            socket.on('ttt-waiting', d => {
                currentGameId = d.gameId;
                document.getElementById('tttStatus').textContent = '‚è≥ Waiting for opponent...';
            });
            socket.on('ttt-start', d => {
                currentGameId = d.gameId;
                myTTTSymbol = d.player1.username === document.getElementById('tttName').value ? 'X' : 'O';
                document.getElementById('tttNameInput').style.display = 'none';
                document.getElementById('tttBoard').style.display = 'grid';
                document.getElementById('tttPlayAgain').style.display = 'none';
                updateTTTBoard(d.board, d.turn);
                document.getElementById('tttStatus').textContent = `You are ${myTTTSymbol} ‚Äî ${d.turn === myTTTSymbol ? 'YOUR TURN!' : 'Opponent\'s turn...'}`;
            });
            socket.on('ttt-update', d => {
                updateTTTBoard(d.board, d.turn);
                if (d.winner) {
                    const won = d.winner === myTTTSymbol;
                    document.getElementById('tttStatus').textContent = won ? 'üèÜ YOU WIN!' : 'üò¢ YOU LOSE!';
                    document.getElementById('tttPlayAgain').style.display = 'inline-flex';
                    disableTTTBoard();
                } else if (d.draw) {
                    document.getElementById('tttStatus').textContent = "ü§ù IT'S A DRAW!";
                    document.getElementById('tttPlayAgain').style.display = 'inline-flex';
                    disableTTTBoard();
                } else {
                    document.getElementById('tttStatus').textContent = d.turn === myTTTSymbol ? 'üéØ YOUR TURN!' : "‚è≥ Opponent's turn...";
                }
            });
            socket.on('ttt-opponent-left', () => {
                document.getElementById('tttStatus').textContent = 'üö™ Opponent left! You win by default.';
                document.getElementById('tttPlayAgain').style.display = 'inline-flex';
                disableTTTBoard();
            });
            
            // === RPS Events ===
            socket.on('rps-waiting', d => {
                currentGameId = d.gameId;
                document.getElementById('rpsStatus').textContent = '‚è≥ Waiting for opponent...';
            });
            socket.on('rps-start', d => {
                currentGameId = d.gameId;
                document.getElementById('rpsNameInput').style.display = 'none';
                document.getElementById('rpsGame').style.display = 'block';
                document.getElementById('rpsPlayAgain').style.display = 'none';
                document.getElementById('rpsP1Name').textContent = d.player1;
                document.getElementById('rpsP2Name').textContent = d.player2;
                document.getElementById('rpsScoreDisplay').textContent = '0 - 0';
                document.getElementById('rpsRound').textContent = 'ROUND 1/5';
                document.getElementById('rpsResult').textContent = '';
                document.getElementById('rpsP1Emoji').textContent = '‚ùì';
                document.getElementById('rpsP2Emoji').textContent = '‚ùì';
                enableRPSChoices();
                document.getElementById('rpsStatus').textContent = '‚úä Make your choice!';
            });
            socket.on('rps-opponent-chose', () => {
                document.getElementById('rpsStatus').textContent = '‚è≥ Opponent has chosen! Your turn...';
            });
            socket.on('rps-result', d => {
                const emojiMap = { rock: 'ü™®', paper: 'üìÑ', scissors: '‚úÇÔ∏è' };
                document.getElementById('rpsP1Emoji').textContent = emojiMap[d.p1Choice];
                document.getElementById('rpsP2Emoji').textContent = emojiMap[d.p2Choice];
                document.getElementById('rpsScoreDisplay').textContent = `${d.scores[0]} - ${d.scores[1]}`;
                document.getElementById('rpsRound').textContent = `ROUND ${d.round}/5`;
                document.getElementById('rpsResult').textContent = d.winner === 'draw' ? 'ü§ù DRAW!' : `üèÜ ${d.winner} wins!`;
                document.getElementById('rpsStatus').textContent = d.winner === 'draw' ? 'ü§ù Draw this round!' : `${d.winner} wins this round!`;
                // Re-enable choices after 2 seconds for next round
                setTimeout(() => {
                    document.getElementById('rpsP1Emoji').textContent = '‚ùì';
                    document.getElementById('rpsP2Emoji').textContent = '‚ùì';
                    document.getElementById('rpsResult').textContent = '';
                    enableRPSChoices();
                    document.getElementById('rpsStatus').textContent = '‚úä Make your choice!';
                }, 2000);
            });
            socket.on('rps-game-over', d => {
                document.getElementById('rpsStatus').textContent = `üèÜ GAME OVER! ${d.winner === 'Draw' ? "It's a draw!" : d.winner + ' wins!'}`;
                document.getElementById('rpsScoreDisplay').textContent = `${d.scores[0]} - ${d.scores[1]}`;
                document.getElementById('rpsPlayAgain').style.display = 'inline-flex';
                disableRPSChoices();
            });
            socket.on('rps-opponent-left', () => {
                document.getElementById('rpsStatus').textContent = 'üö™ Opponent left!';
                document.getElementById('rpsPlayAgain').style.display = 'inline-flex';
                disableRPSChoices();
            });
            
            // === Trivia Events ===
            socket.on('trivia-waiting', d => {
                currentGameId = d.gameId;
                document.getElementById('triviaNameInput').style.display = 'none';
                document.getElementById('triviaLobby').style.display = 'block';
                document.getElementById('triviaStartBtn').style.display = 'inline-flex';
                document.getElementById('triviaStatus').textContent = '‚è≥ Waiting for more players...';
                updateTriviaPlayers([{ username: document.getElementById('triviaName').value, score: 0 }]);
            });
            socket.on('trivia-player-joined', d => {
                currentGameId = d.gameId;
                document.getElementById('triviaNameInput').style.display = 'none';
                document.getElementById('triviaLobby').style.display = 'block';
                updateTriviaPlayers(d.players);
                if (d.hostCanStart) {
                    document.getElementById('triviaStatus').textContent = '‚úÖ Ready to start!';
                }
            });
            socket.on('trivia-game-started', d => {
                document.getElementById('triviaLobby').style.display = 'none';
                document.getElementById('triviaGame').style.display = 'block';
                document.getElementById('triviaScoreboard').style.display = 'block';
                document.getElementById('triviaPlayAgain').style.display = 'none';
                document.getElementById('triviaStatus').textContent = `üß† ${d.totalQuestions} questions ‚Äî let's go!`;
                updateTriviaScoreboard(d.players);
            });
            socket.on('trivia-question', d => {
                document.getElementById('triviaCategory').textContent = `${d.category} (${d.difficulty})`;
                document.getElementById('triviaQuestion').textContent = d.question;
                document.getElementById('triviaStatus').textContent = `Question ${d.index + 1}/${d.total}`;
                const opts = document.getElementById('triviaOptions');
                opts.innerHTML = d.options.map((o, i) => `<div class="trivia-option" onclick="triviaAnswer('${escapeAttr(o)}')">${o}</div>`).join('');
                startTriviaTimer(d.timeLimit);
            });
            socket.on('trivia-answer-result', d => {
                // Highlight correct/wrong after answering
                const opts = document.querySelectorAll('.trivia-option');
                opts.forEach(o => {
                    o.classList.add('disabled');
                    if (o.textContent === d.correctAnswer) o.classList.add('correct');
                });
            });
            socket.on('trivia-scores', d => {
                stopTriviaTimer();
                // Highlight correct answer for everyone
                const opts = document.querySelectorAll('.trivia-option');
                opts.forEach(o => {
                    o.classList.add('disabled');
                    if (o.textContent === d.correctAnswer) o.classList.add('correct');
                });
                updateTriviaScoreboard(d.scores);
            });
            socket.on('trivia-game-over', d => {
                stopTriviaTimer();
                document.getElementById('triviaGame').style.display = 'none';
                document.getElementById('triviaStatus').textContent = `üèÜ GAME OVER! ${d.winner} wins!`;
                updateTriviaScoreboard(d.scores);
                document.getElementById('triviaPlayAgain').style.display = 'inline-flex';
            });
            socket.on('trivia-player-left', d => {
                updateTriviaPlayers(d.players);
                updateTriviaScoreboard(d.players);
            });
        }
        
        // === GAME NAVIGATION ===
        function startGame(type) {
            document.getElementById('gameSelect').style.display = 'none';
            document.getElementById('roomsSection').style.display = 'none';
            document.getElementById(type + 'Area').classList.add('active');
            currentGameType = type;
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        function leaveGame(type) {
            if (currentGameId && socket) {
                socket.emit(type + '-leave', { gameId: currentGameId });
            }
            currentGameId = null;
            currentGameType = null;
            myTTTSymbol = null;
            stopTriviaTimer();
            
            // Reset all game areas
            document.querySelectorAll('.game-area').forEach(a => a.classList.remove('active'));
            document.getElementById('gameSelect').style.display = '';
            document.getElementById('roomsSection').style.display = '';
            
            // Reset game UIs
            resetTTT(); resetRPS(); resetTrivia();
        }
        
        // === TTT Functions ===
        function findTTTGame() {
            const name = document.getElementById('tttName').value.trim();
            if (!name) { alert('Enter your name!'); return; }
            document.getElementById('tttPlayAgain').style.display = 'none';
            resetTTTBoard();
            socket.emit('ttt-find-game', { username: name });
            document.getElementById('tttStatus').textContent = 'üîç Finding opponent...';
        }
        
        function tttMove(cell) {
            if (!currentGameId) return;
            socket.emit('ttt-move', { gameId: currentGameId, cell });
        }
        
        function updateTTTBoard(board, turn) {
            const cells = document.querySelectorAll('.ttt-cell');
            board.forEach((val, i) => {
                cells[i].textContent = val === 'X' ? '‚úï' : val === 'O' ? '‚óã' : '';
                cells[i].className = 'ttt-cell' + (val === 'X' ? ' x' : val === 'O' ? ' o' : '');
                if (val || turn !== myTTTSymbol) cells[i].classList.add('disabled');
            });
        }
        
        function disableTTTBoard() {
            document.querySelectorAll('.ttt-cell').forEach(c => c.classList.add('disabled'));
        }
        
        function resetTTTBoard() {
            document.querySelectorAll('.ttt-cell').forEach(c => { c.textContent = ''; c.className = 'ttt-cell'; });
        }
        
        function resetTTT() {
            document.getElementById('tttNameInput').style.display = '';
            document.getElementById('tttBoard').style.display = 'none';
            document.getElementById('tttPlayAgain').style.display = 'none';
            document.getElementById('tttStatus').textContent = 'Enter your name to find an opponent...';
            resetTTTBoard();
        }
        
        // === RPS Functions ===
        function findRPSGame() {
            const name = document.getElementById('rpsName').value.trim();
            if (!name) { alert('Enter your name!'); return; }
            document.getElementById('rpsPlayAgain').style.display = 'none';
            document.getElementById('rpsGame').style.display = 'none';
            document.getElementById('rpsNameInput').style.display = '';
            socket.emit('rps-find-game', { username: name });
            document.getElementById('rpsStatus').textContent = 'üîç Finding opponent...';
            document.getElementById('rpsNameInput').style.display = 'none';
        }
        
        function rpsChoose(choice) {
            if (!currentGameId) return;
            socket.emit('rps-choose', { gameId: currentGameId, choice });
            document.querySelectorAll('.rps-choice').forEach(c => {
                c.classList.remove('selected');
                if (c.querySelector('span').textContent === choice.toUpperCase()) c.classList.add('selected');
            });
            disableRPSChoices();
            document.getElementById('rpsStatus').textContent = '‚è≥ Waiting for opponent...';
        }
        
        function enableRPSChoices() {
            document.querySelectorAll('.rps-choice').forEach(c => { c.style.pointerEvents = 'auto'; c.classList.remove('selected'); });
        }
        function disableRPSChoices() {
            document.querySelectorAll('.rps-choice').forEach(c => c.style.pointerEvents = 'none');
        }
        
        function resetRPS() {
            document.getElementById('rpsNameInput').style.display = '';
            document.getElementById('rpsGame').style.display = 'none';
            document.getElementById('rpsPlayAgain').style.display = 'none';
            document.getElementById('rpsStatus').textContent = 'Enter your name to find an opponent...';
        }
        
        // === Trivia Functions ===
        function findTriviaGame() {
            const name = document.getElementById('triviaName').value.trim();
            if (!name) { alert('Enter your name!'); return; }
            document.getElementById('triviaPlayAgain').style.display = 'none';
            document.getElementById('triviaGame').style.display = 'none';
            document.getElementById('triviaScoreboard').style.display = 'none';
            document.getElementById('triviaLobby').style.display = 'none';
            socket.emit('trivia-find-game', { username: name });
            document.getElementById('triviaStatus').textContent = 'üîç Finding quiz session...';
            document.getElementById('triviaNameInput').style.display = 'none';
        }
        
        function startTrivia() {
            if (!currentGameId) return;
            socket.emit('trivia-start', { gameId: currentGameId });
            document.getElementById('triviaStatus').textContent = 'üöÄ Starting quiz...';
        }
        
        function triviaAnswer(answer) {
            if (!currentGameId) return;
            const timeLeft = parseInt(document.getElementById('triviaTimer').textContent) || 0;
            socket.emit('trivia-answer', { gameId: currentGameId, answer, timeLeft });
            // Highlight selected
            document.querySelectorAll('.trivia-option').forEach(o => {
                if (o.textContent === answer) o.style.borderColor = 'var(--arcade-cyan)';
                o.classList.add('disabled');
            });
        }
        
        function startTriviaTimer(seconds) {
            stopTriviaTimer();
            const el = document.getElementById('triviaTimer');
            let time = seconds;
            el.textContent = time;
            el.classList.remove('urgent');
            triviaTimerInterval = setInterval(() => {
                time--;
                el.textContent = time;
                if (time <= 5) el.classList.add('urgent');
                if (time <= 0) { stopTriviaTimer(); }
            }, 1000);
        }
        
        function stopTriviaTimer() {
            if (triviaTimerInterval) { clearInterval(triviaTimerInterval); triviaTimerInterval = null; }
        }
        
        function updateTriviaPlayers(players) {
            document.getElementById('triviaPlayerList').innerHTML = players.map(p => 
                `<span class="trivia-player-tag">üë§ ${escapeHtml(p.username)}</span>`
            ).join('');
        }
        
        function updateTriviaScoreboard(scores) {
            document.getElementById('triviaScoreboard').style.display = 'block';
            document.getElementById('triviaScores').innerHTML = scores.map((s, i) => `
                <div class="trivia-score-row">
                    <span class="rank">#${i + 1}</span>
                    <span class="name">${escapeHtml(s.username)}</span>
                    <span class="score">${s.score}</span>
                </div>
            `).join('');
        }
        
        function resetTrivia() {
            document.getElementById('triviaNameInput').style.display = '';
            document.getElementById('triviaLobby').style.display = 'none';
            document.getElementById('triviaGame').style.display = 'none';
            document.getElementById('triviaScoreboard').style.display = 'none';
            document.getElementById('triviaPlayAgain').style.display = 'none';
            document.getElementById('triviaStatus').textContent = 'Enter your name to join a trivia session...';
            stopTriviaTimer();
        }
        
        // === Room Functions ===
        function createRoom() {
            const u = prompt('Player name?');
            if (!u?.trim()) return;
            pendingHost = u.trim();
            if (socket) socket.emit('create-room', { name: `${u}'s Game`, description: 'Ready Player One. Join the fun!', maxParticipants: 10, isPrivate: false, type: 'arcade' });
            else window.location.href = `pub-stream.html?v=${Date.now()}&room=${Math.random().toString(36).substring(2,8).toUpperCase()}&username=${encodeURIComponent(u.trim())}&host=1&type=arcade`;
        }
        function refreshRooms() { if (socket) socket.emit('get-room-list'); }
        function joinRoom(id) {
            const u = prompt('Player name?');
            if (!u?.trim()) return;
            window.location.href = `pub-stream.html?v=${Date.now()}&room=${id}&username=${encodeURIComponent(u.trim())}&host=0&type=arcade`;
        }
        
        function updateRoomList(rooms) {
            const l = document.getElementById('roomsList'), e = document.getElementById('noRooms');
            if (!rooms.length) { l.style.display = 'none'; e.style.display = 'block'; return; }
            l.style.display = 'grid'; e.style.display = 'none';
            l.innerHTML = rooms.map(r => `
                <div class="room-card" onclick="joinRoom('${r.id}')">
                    <div class="room-card-header">
                        <div class="room-card-icon"><i class="fas fa-gamepad"></i></div>
                        <h3 class="room-card-title">${escapeHtml(r.name)}</h3>
                    </div>
                    <p class="room-card-description">${escapeHtml(r.description)}</p>
                    <div class="room-card-stats">
                        <div class="room-card-stat"><i class="fas fa-users"></i> ${r.participantCount}/${r.maxParticipants}</div>
                        <div class="room-card-stat"><i class="fas fa-circle ${r.hasStreamer ? 'live' : 'offline'}"></i> ${r.hasStreamer ? 'Live' : 'Waiting'}</div>
                    </div>
                </div>
            `).join('');
        }
        function updateStats(s) {
            document.getElementById('totalUsers').textContent = s.totalUsers || 0;
            document.getElementById('activeRooms').textContent = s.activeRooms || 0;
            document.getElementById('liveStreams').textContent = s.liveStreams || 0;
        }
        
        function escapeHtml(t) { const d = document.createElement('div'); d.textContent = t; return d.innerHTML; }
        function escapeAttr(t) { return t.replace(/'/g, "\\'").replace(/"/g, '&quot;'); }
        
        document.addEventListener('DOMContentLoaded', initSocket);
    </script>
</body>
</html>
