<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Aetherium Lab ‚Äî ChiffTown</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --lab-void: #030810;
            --lab-dark: #081020;
            --lab-surface: #0c1a30;
            --lab-glass: rgba(12, 26, 48, 0.75);
            --neon-cyan: #00e5ff;
            --neon-teal: #00bcd4;
            --accent-gold: #c9a84c;
            --accent-silver: #b0bec5;
            --text-primary: #e8eaf6;
            --text-dim: rgba(232,234,246,0.5);
            --glass-border: rgba(255,255,255,0.06);
        }
        body {
            font-family: 'Inter', sans-serif;
            background: var(--lab-void);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }
        body::before {
            content: '';
            position: fixed; inset: 0;
            background:
                radial-gradient(ellipse at 30% 20%, rgba(0,229,255,0.04) 0%, transparent 60%),
                radial-gradient(ellipse at 70% 70%, rgba(0,188,212,0.03) 0%, transparent 50%);
            z-index: 0;
        }

        /* Navbar */
        .navbar {
            position: fixed; top: 0; left: 0; right: 0; z-index: 1000;
            padding: 0.75rem 2rem;
            background: rgba(3, 8, 16, 0.92);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(0,229,255,0.12);
            display: flex; align-items: center; justify-content: space-between;
        }
        .navbar a { color: var(--text-primary); text-decoration: none; }
        .nav-brand { font-family: 'Rajdhani', sans-serif; font-size: 1.15rem; font-weight: 700; color: var(--neon-cyan); letter-spacing: 2px; }
        .back-link { display: flex; align-items: center; gap: 8px; color: var(--neon-teal); font-size: 0.9rem; transition: color 0.2s; }
        .back-link:hover { color: #fff; }

        .content { position: relative; z-index: 1; padding-top: 80px; }
        .container { max-width: 1100px; margin: 0 auto; padding: 0 1.5rem; }

        /* Hero */
        .hero { text-align: center; padding: 2.5rem 0 2rem; }
        .hero-icon { font-size: 3.5rem; margin-bottom: 0.8rem; display: inline-block; animation: float 3s ease-in-out infinite; }
        @keyframes float { 0%,100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }
        .hero h1 {
            font-family: 'Rajdhani', sans-serif; font-size: 2.5rem; font-weight: 700; letter-spacing: 3px;
            background: linear-gradient(135deg, var(--neon-cyan), var(--accent-gold));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            margin-bottom: 0.4rem;
        }
        .hero p { color: var(--text-dim); font-size: 1rem; max-width: 480px; margin: 0 auto; }

        /* Tabs */
        .lab-tabs {
            display: flex; justify-content: center; gap: 0.5rem; margin-bottom: 2rem; flex-wrap: wrap;
        }
        .lab-tab {
            background: var(--lab-glass); border: 1px solid var(--glass-border);
            color: var(--text-dim); padding: 0.6rem 1.2rem; border-radius: 10px;
            font-weight: 600; font-size: 0.85rem; cursor: pointer; transition: all 0.2s;
        }
        .lab-tab:hover { border-color: rgba(0,229,255,0.3); color: var(--text-primary); }
        .lab-tab.active { background: rgba(0,229,255,0.1); border-color: var(--neon-cyan); color: var(--neon-cyan); }
        .lab-panel { display: none; }
        .lab-panel.active { display: block; }

        /* Shared card */
        .card {
            background: var(--lab-glass); border: 1px solid var(--glass-border);
            border-radius: 16px; padding: 1.5rem; backdrop-filter: blur(8px);
            margin-bottom: 1.2rem;
        }
        .card-title {
            font-family: 'Rajdhani', sans-serif; font-size: 1.1rem; font-weight: 700;
            color: var(--neon-cyan); margin-bottom: 0.8rem;
        }

        /* Particle sim */
        #particleCanvas {
            width: 100%; height: 400px; border-radius: 12px;
            background: rgba(0,0,0,0.4); border: 1px solid var(--glass-border);
            cursor: crosshair; display: block;
        }
        .sim-controls { display: flex; gap: 0.6rem; margin-top: 1rem; flex-wrap: wrap; align-items: center; }
        .sim-btn {
            background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1);
            color: var(--text-primary); border-radius: 8px; padding: 0.5rem 1rem;
            font-weight: 600; font-size: 0.8rem; cursor: pointer; transition: all 0.2s;
        }
        .sim-btn:hover { border-color: var(--neon-cyan); }
        .sim-btn.active { background: var(--neon-cyan); color: #000; border-color: var(--neon-cyan); }
        .sim-label { font-size: 0.8rem; color: var(--text-dim); }
        .sim-slider { -webkit-appearance: none; width: 100px; height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; outline: none; }
        .sim-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 14px; height: 14px; border-radius: 50%; background: var(--neon-cyan); cursor: pointer; }

        /* Chemistry */
        .elements-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(70px, 1fr)); gap: 0.5rem; margin-bottom: 1rem; }
        .element-btn {
            background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.08);
            border-radius: 10px; padding: 0.6rem 0.3rem; text-align: center; cursor: pointer;
            transition: all 0.2s; font-size: 0.75rem;
        }
        .element-btn:hover { border-color: var(--neon-cyan); transform: scale(1.05); }
        .element-btn.selected { border-color: var(--accent-gold); background: rgba(201,168,76,0.1); }
        .element-symbol { font-family: 'Rajdhani', sans-serif; font-size: 1.4rem; font-weight: 700; color: var(--neon-cyan); }
        .element-name { font-size: 0.65rem; color: var(--text-dim); }
        .mix-area {
            display: flex; align-items: center; justify-content: center; gap: 1rem;
            padding: 1.5rem; min-height: 80px; flex-wrap: wrap;
        }
        .mix-slot {
            width: 60px; height: 60px; border: 2px dashed rgba(255,255,255,0.1);
            border-radius: 12px; display: flex; align-items: center; justify-content: center;
            font-family: 'Rajdhani', sans-serif; font-size: 1.3rem; font-weight: 700; color: var(--neon-cyan);
        }
        .mix-slot.filled { border-style: solid; border-color: var(--neon-cyan); background: rgba(0,229,255,0.05); }
        .mix-plus { font-size: 1.5rem; color: var(--text-dim); }
        .mix-result {
            text-align: center; padding: 1rem; margin-top: 0.5rem;
            border-radius: 12px; min-height: 60px;
        }
        .result-name { font-family: 'Rajdhani', sans-serif; font-size: 1.3rem; font-weight: 700; color: var(--accent-gold); }
        .result-desc { font-size: 0.85rem; color: var(--text-dim); margin-top: 0.3rem; }
        .result-emoji { font-size: 2.5rem; margin-bottom: 0.5rem; }
        .discoveries-count { font-size: 0.8rem; color: var(--accent-gold); text-align: center; margin-top: 0.8rem; }

        /* Space */
        .space-card {
            text-align: center; padding: 2rem;
        }
        .space-emoji { font-size: 4rem; margin-bottom: 1rem; display: block; }
        .space-title { font-family: 'Rajdhani', sans-serif; font-size: 1.4rem; font-weight: 700; color: var(--neon-cyan); margin-bottom: 0.5rem; }
        .space-fact { color: var(--text-primary); font-size: 0.95rem; line-height: 1.6; max-width: 600px; margin: 0 auto 1rem; }
        .space-category { font-size: 0.7rem; color: var(--accent-gold); text-transform: uppercase; letter-spacing: 2px; margin-bottom: 0.5rem; }
        .space-nav { display: flex; justify-content: center; gap: 1rem; margin-top: 1rem; }

        /* Lab Notes */
        .note-form { margin-bottom: 1.5rem; }
        .note-row { display: flex; gap: 0.6rem; margin-bottom: 0.6rem; flex-wrap: wrap; }
        .note-input {
            flex: 1; min-width: 150px; background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.08); border-radius: 10px;
            padding: 0.65rem 1rem; color: var(--text-primary); font-family: 'Inter', sans-serif;
            font-size: 0.9rem; outline: none; transition: border-color 0.2s;
        }
        .note-input:focus { border-color: var(--neon-cyan); }
        .note-input::placeholder { color: var(--text-dim); }
        textarea.note-input { min-height: 70px; resize: vertical; }
        .note-submit { background: linear-gradient(135deg, var(--neon-teal), #1e88e5); color: #fff; border: none; border-radius: 10px; padding: 0.65rem 1.5rem; font-weight: 600; cursor: pointer; font-size: 0.85rem; }
        .notes-list { display: flex; flex-direction: column; gap: 0.8rem; }
        .note-item {
            background: rgba(0,0,0,0.2); border: 1px solid var(--glass-border);
            border-radius: 12px; padding: 1rem 1.2rem;
        }
        .note-author { font-weight: 600; color: var(--neon-teal); font-size: 0.85rem; }
        .note-time { font-size: 0.7rem; color: var(--text-dim); margin-left: 8px; }
        .note-text { margin-top: 0.4rem; font-size: 0.9rem; line-height: 1.5; }
        .note-tag { display: inline-block; background: rgba(0,229,255,0.1); border: 1px solid rgba(0,229,255,0.2); border-radius: 6px; padding: 2px 8px; font-size: 0.7rem; color: var(--neon-cyan); margin-top: 0.4rem; }

        .footer { text-align: center; padding: 3rem 0; color: var(--text-dim); font-size: 0.8rem; }

        @media (max-width: 768px) {
            .hero h1 { font-size: 1.8rem; }
            #particleCanvas { height: 280px; }
            .elements-grid { grid-template-columns: repeat(4, 1fr); }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <a href="/" class="back-link"><i class="fas fa-arrow-left"></i> Back to Town</a>
        <span class="nav-brand">üî¨ AETHERIUM LAB</span>
        <span></span>
    </nav>

    <div class="content">
        <div class="container">
            <div class="hero">
                <div class="hero-icon">üî¨</div>
                <h1>THE AETHERIUM LAB</h1>
                <p>Experiment, discover, and push the boundaries of science.</p>
            </div>

            <!-- Tabs -->
            <div class="lab-tabs">
                <button class="lab-tab active" onclick="switchTab('particles')"><i class="fas fa-atom"></i> Particle Sim</button>
                <button class="lab-tab" onclick="switchTab('chemistry')"><i class="fas fa-flask"></i> Chemistry</button>
                <button class="lab-tab" onclick="switchTab('space')"><i class="fas fa-rocket"></i> Space</button>
                <button class="lab-tab" onclick="switchTab('notes')"><i class="fas fa-clipboard"></i> Lab Notes</button>
            </div>

            <!-- PARTICLE SIMULATOR -->
            <div class="lab-panel active" id="panel-particles">
                <div class="card">
                    <div class="card-title"><i class="fas fa-atom"></i> Particle Simulator</div>
                    <p style="font-size:0.8rem;color:var(--text-dim);margin-bottom:1rem;">Click to spawn particles. They interact with gravity and bounce off walls.</p>
                    <canvas id="particleCanvas"></canvas>
                    <div class="sim-controls">
                        <button class="sim-btn active" id="btnGravity" onclick="toggleGravity()">üåç Gravity</button>
                        <button class="sim-btn" id="btnAttract" onclick="toggleAttract()">üß≤ Attract</button>
                        <button class="sim-btn" onclick="clearParticles()">üóëÔ∏è Clear</button>
                        <button class="sim-btn" onclick="spawnBurst()">üí• Burst</button>
                        <span class="sim-label">Size:</span>
                        <input type="range" class="sim-slider" id="sizeSlider" min="2" max="12" value="4">
                        <span class="sim-label" id="particleCount">0 particles</span>
                    </div>
                </div>
            </div>

            <!-- CHEMISTRY -->
            <div class="lab-panel" id="panel-chemistry">
                <div class="card">
                    <div class="card-title"><i class="fas fa-flask"></i> Element Mixer</div>
                    <p style="font-size:0.8rem;color:var(--text-dim);margin-bottom:1rem;">Select two elements to combine them. Discover all the reactions!</p>
                    <div class="elements-grid" id="elementsGrid"></div>
                    <div class="card" style="margin-top:1rem;background:rgba(0,0,0,0.2);">
                        <div class="mix-area">
                            <div class="mix-slot" id="slot1">?</div>
                            <span class="mix-plus">+</span>
                            <div class="mix-slot" id="slot2">?</div>
                            <span class="mix-plus">=</span>
                            <div class="mix-slot" id="slotResult" style="width:auto;min-width:60px;padding:0 10px;">?</div>
                        </div>
                        <div class="mix-result" id="mixResult"></div>
                        <button class="sim-btn" onclick="clearMix()" style="display:block;margin:0.5rem auto 0;">‚Ü∫ Reset</button>
                    </div>
                    <div class="discoveries-count" id="discoveriesCount"></div>
                </div>
            </div>

            <!-- SPACE EXPLORER -->
            <div class="lab-panel" id="panel-space">
                <div class="card space-card" id="spaceCard">
                    <div class="space-category" id="spaceCategory"></div>
                    <div class="space-emoji" id="spaceEmoji"></div>
                    <div class="space-title" id="spaceTitle"></div>
                    <div class="space-fact" id="spaceFact"></div>
                    <div class="space-nav">
                        <button class="sim-btn" onclick="prevFact()">‚Üê Previous</button>
                        <button class="sim-btn" onclick="randomFact()">üé≤ Random</button>
                        <button class="sim-btn" onclick="nextFact()">Next ‚Üí</button>
                    </div>
                </div>
            </div>

            <!-- LAB NOTES -->
            <div class="lab-panel" id="panel-notes">
                <div class="card">
                    <div class="card-title"><i class="fas fa-clipboard"></i> Community Lab Notes</div>
                    <div class="note-form">
                        <div class="note-row">
                            <input type="text" class="note-input" id="noteAuthor" placeholder="Scientist name" maxlength="25">
                            <select class="note-input" id="noteTag" style="max-width:160px;">
                                <option value="discovery">üîç Discovery</option>
                                <option value="theory">üí° Theory</option>
                                <option value="experiment">üß™ Experiment</option>
                                <option value="observation">üëÅÔ∏è Observation</option>
                                <option value="question">‚ùì Question</option>
                            </select>
                        </div>
                        <div class="note-row">
                            <textarea class="note-input" id="noteText" placeholder="Document your findings..." maxlength="400"></textarea>
                        </div>
                        <button class="note-submit" onclick="submitNote()">üìù Log Entry</button>
                    </div>
                    <div class="notes-list" id="notesList"></div>
                </div>
            </div>

            <div class="footer">üî¨ The Aetherium Lab ‚Äî ChiffTown</div>
        </div>
    </div>

    <script>
    // ============================
    // TAB SWITCHING
    // ============================
    function switchTab(tab) {
        document.querySelectorAll('.lab-tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.lab-panel').forEach(p => p.classList.remove('active'));
        document.getElementById('panel-' + tab).classList.add('active');
        event.target.closest('.lab-tab').classList.add('active');
        if (tab === 'particles' && !simRunning) startSim();
    }

    // ============================
    // PARTICLE SIMULATOR
    // ============================
    const canvas = document.getElementById('particleCanvas');
    const ctx = canvas.getContext('2d');
    let particles = [], simRunning = false, gravityOn = true, attractOn = false;

    function resizeCanvas() {
        const rect = canvas.getBoundingClientRect();
        canvas.width = rect.width * window.devicePixelRatio;
        canvas.height = rect.height * window.devicePixelRatio;
        ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
    }

    function startSim() {
        resizeCanvas();
        simRunning = true;
        requestAnimationFrame(simLoop);
    }

    function simLoop() {
        if (!simRunning) return;
        const w = canvas.width / window.devicePixelRatio;
        const h = canvas.height / window.devicePixelRatio;
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        particles.forEach(p => {
            // Gravity
            if (gravityOn) p.vy += 0.15;

            // Mouse attract
            if (attractOn && lastMouse.x) {
                const dx = lastMouse.x - p.x, dy = lastMouse.y - p.y;
                const dist = Math.sqrt(dx*dx + dy*dy) + 1;
                p.vx += (dx / dist) * 0.3;
                p.vy += (dy / dist) * 0.3;
            }

            // Friction
            p.vx *= 0.995;
            p.vy *= 0.995;

            p.x += p.vx;
            p.y += p.vy;

            // Bounce
            if (p.x < p.r) { p.x = p.r; p.vx *= -0.7; }
            if (p.x > w - p.r) { p.x = w - p.r; p.vx *= -0.7; }
            if (p.y < p.r) { p.y = p.r; p.vy *= -0.7; }
            if (p.y > h - p.r) { p.y = h - p.r; p.vy *= -0.7; }

            // Age
            p.life -= 0.001;

            // Draw
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
            ctx.fillStyle = p.color;
            ctx.globalAlpha = Math.max(0, p.life);
            ctx.fill();
            ctx.globalAlpha = 1;

            // Glow
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.r * 2, 0, Math.PI * 2);
            const grad = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.r * 2);
            grad.addColorStop(0, p.color.replace(')', ',0.15)').replace('rgb', 'rgba'));
            grad.addColorStop(1, 'transparent');
            ctx.fillStyle = grad;
            ctx.fill();
        });

        // Remove dead
        particles = particles.filter(p => p.life > 0);
        document.getElementById('particleCount').textContent = particles.length + ' particles';

        requestAnimationFrame(simLoop);
    }

    const PARTICLE_COLORS = [
        'rgb(0,229,255)', 'rgb(0,188,212)', 'rgb(30,136,229)',
        'rgb(201,168,76)', 'rgb(176,190,197)', 'rgb(100,255,218)'
    ];

    function spawnAt(x, y, count = 1) {
        const size = parseInt(document.getElementById('sizeSlider').value);
        for (let i = 0; i < count; i++) {
            particles.push({
                x: x + (Math.random()-0.5) * 10,
                y: y + (Math.random()-0.5) * 10,
                vx: (Math.random()-0.5) * 6,
                vy: (Math.random()-0.5) * 6 - 2,
                r: size * (0.5 + Math.random() * 0.5),
                color: PARTICLE_COLORS[Math.floor(Math.random() * PARTICLE_COLORS.length)],
                life: 1.0
            });
        }
        // Cap at 500
        if (particles.length > 500) particles.splice(0, particles.length - 500);
    }

    let lastMouse = { x: 0, y: 0 };
    canvas.addEventListener('click', e => {
        const rect = canvas.getBoundingClientRect();
        spawnAt(e.clientX - rect.left, e.clientY - rect.top, 8);
    });
    canvas.addEventListener('mousemove', e => {
        const rect = canvas.getBoundingClientRect();
        lastMouse.x = e.clientX - rect.left;
        lastMouse.y = e.clientY - rect.top;
    });
    canvas.addEventListener('touchstart', e => {
        e.preventDefault();
        const rect = canvas.getBoundingClientRect();
        const t = e.touches[0];
        spawnAt(t.clientX - rect.left, t.clientY - rect.top, 8);
    }, { passive: false });

    function toggleGravity() { gravityOn = !gravityOn; document.getElementById('btnGravity').classList.toggle('active', gravityOn); }
    function toggleAttract() { attractOn = !attractOn; document.getElementById('btnAttract').classList.toggle('active', attractOn); }
    function clearParticles() { particles = []; }
    function spawnBurst() {
        const w = canvas.width / window.devicePixelRatio;
        const h = canvas.height / window.devicePixelRatio;
        spawnAt(w/2, h/2, 50);
    }

    window.addEventListener('resize', resizeCanvas);
    startSim();

    // ============================
    // CHEMISTRY MIXER
    // ============================
    const ELEMENTS = [
        { sym: 'H', name: 'Hydrogen', color: '#00e5ff' },
        { sym: 'O', name: 'Oxygen', color: '#4fc3f7' },
        { sym: 'C', name: 'Carbon', color: '#b0bec5' },
        { sym: 'N', name: 'Nitrogen', color: '#80cbc4' },
        { sym: 'Fe', name: 'Iron', color: '#90a4ae' },
        { sym: 'Au', name: 'Gold', color: '#c9a84c' },
        { sym: 'Na', name: 'Sodium', color: '#ffca28' },
        { sym: 'Cl', name: 'Chlorine', color: '#66bb6a' },
        { sym: 'He', name: 'Helium', color: '#ef5350' },
        { sym: 'Li', name: 'Lithium', color: '#ce93d8' },
        { sym: 'Ag', name: 'Silver', color: '#cfd8dc' },
        { sym: 'Cu', name: 'Copper', color: '#ff8a65' },
    ];

    const REACTIONS = {
        'H+O': { emoji: 'üíß', name: 'Water (H‚ÇÇO)', desc: 'The molecule of life. Two hydrogens bond with oxygen to form water.' },
        'H+H': { emoji: 'üí•', name: 'Hydrogen Gas (H‚ÇÇ)', desc: 'Highly flammable! The lightest element doubled.' },
        'C+O': { emoji: 'üí®', name: 'Carbon Dioxide (CO‚ÇÇ)', desc: 'What you exhale. Plants love this stuff.' },
        'Na+Cl': { emoji: 'üßÇ', name: 'Table Salt (NaCl)', desc: 'Sodium + Chlorine = the most famous seasoning in history.' },
        'Fe+O': { emoji: 'üü§', name: 'Iron Oxide (Rust)', desc: 'Iron meets oxygen and slowly crumbles. Time wins again.' },
        'Fe+C': { emoji: '‚öîÔ∏è', name: 'Steel', desc: 'Add carbon to iron and you get the backbone of civilization.' },
        'H+N': { emoji: 'üè≠', name: 'Ammonia (NH‚ÇÉ)', desc: 'A pungent gas used in fertilizers. Smells awful, feeds billions.' },
        'Au+Au': { emoji: 'üëë', name: 'Pure Gold Bar', desc: 'Gold on gold. The ultimate flex since 3000 BCE.' },
        'H+Cl': { emoji: '‚öóÔ∏è', name: 'Hydrochloric Acid', desc: 'Careful! This acid can dissolve metals. Your stomach has it too.' },
        'C+C': { emoji: 'üíé', name: 'Diamond', desc: 'Carbon atoms locked in a perfect crystal lattice. Pressure makes beauty.' },
        'He+He': { emoji: 'üéà', name: 'Party Balloons', desc: 'Double helium = double the squeaky voice potential.' },
        'Na+O': { emoji: 'üî•', name: 'Sodium Oxide', desc: 'Sodium reacts violently with oxygen. Don\'t try this at home.' },
        'Li+O': { emoji: 'üîã', name: 'Lithium Oxide', desc: 'The foundation of rechargeable batteries. Powers your phone.' },
        'Cu+O': { emoji: 'üóΩ', name: 'Copper Oxide (Patina)', desc: 'Why the Statue of Liberty is green. Copper + air + time.' },
        'Ag+Cl': { emoji: 'üì∏', name: 'Silver Chloride', desc: 'Light-sensitive! This is how old film photography worked.' },
        'N+O': { emoji: 'üòÇ', name: 'Nitrous Oxide', desc: 'Laughing gas! Used in dentistry and drag racing.' },
        'H+C': { emoji: '‚õΩ', name: 'Methane (CH‚ÇÑ)', desc: 'Natural gas. Also what cows burp out. A lot.' },
        'Au+Cl': { emoji: 'üß™', name: 'Gold Chloride', desc: 'A rare compound used in gold plating and medieval alchemy.' },
        'Cu+Ag': { emoji: 'ü™ô', name: 'Electrum Alloy', desc: 'The ancient alloy used for the very first coins in history.' },
        'Fe+Au': { emoji: 'üèÜ', name: 'Gilded Iron', desc: 'Strength meets beauty. Iron core with a golden shell.' },
        'Li+H': { emoji: 'üõ°Ô∏è', name: 'Lithium Hydride', desc: 'Used in nuclear fusion research. Light but mighty.' },
        'N+N': { emoji: 'üå¨Ô∏è', name: 'Nitrogen Gas (N‚ÇÇ)', desc: '78% of every breath you take is this invisible gas.' },
        'O+O': { emoji: 'ü´Å', name: 'Oxygen Gas (O‚ÇÇ)', desc: 'The gas that keeps you alive. Thank a plant today.' },
        'C+N': { emoji: '‚ò†Ô∏è', name: 'Cyanide (CN)', desc: 'One of nature\'s deadliest molecules. Handle with extreme care.' },
    };

    let selectedElements = [], discoveries = new Set();
    const DISC_KEY = 'aetherium_discoveries';

    function loadDiscoveries() {
        try { discoveries = new Set(JSON.parse(localStorage.getItem(DISC_KEY) || '[]')); } catch(e) {}
    }
    function saveDiscoveries() {
        localStorage.setItem(DISC_KEY, JSON.stringify([...discoveries]));
    }

    function renderElements() {
        document.getElementById('elementsGrid').innerHTML = ELEMENTS.map(el => `
            <div class="element-btn" onclick="selectElement('${el.sym}')" id="el-${el.sym}">
                <div class="element-symbol" style="color:${el.color}">${el.sym}</div>
                <div class="element-name">${el.name}</div>
            </div>
        `).join('');
    }

    function selectElement(sym) {
        if (selectedElements.length >= 2) return;
        selectedElements.push(sym);
        document.getElementById('el-' + sym).classList.add('selected');

        const slotId = selectedElements.length === 1 ? 'slot1' : 'slot2';
        const slot = document.getElementById(slotId);
        slot.textContent = sym;
        slot.classList.add('filled');

        if (selectedElements.length === 2) {
            setTimeout(tryReaction, 400);
        }
    }

    function tryReaction() {
        const [a, b] = selectedElements.sort();
        const key = a + '+' + b;
        const result = REACTIONS[key];
        const resultEl = document.getElementById('mixResult');
        const slotResult = document.getElementById('slotResult');

        if (result) {
            const isNew = !discoveries.has(key);
            discoveries.add(key);
            saveDiscoveries();
            slotResult.textContent = result.emoji;
            slotResult.classList.add('filled');
            resultEl.innerHTML = `
                <div class="result-emoji">${result.emoji}</div>
                <div class="result-name">${isNew ? 'üÜï ' : ''}${result.name}</div>
                <div class="result-desc">${result.desc}</div>
            `;
        } else {
            slotResult.textContent = '‚ùå';
            resultEl.innerHTML = `<div class="result-desc" style="color:var(--text-dim);">No reaction. Try a different combination!</div>`;
        }
        updateDiscCount();
    }

    function clearMix() {
        selectedElements = [];
        document.querySelectorAll('.element-btn').forEach(e => e.classList.remove('selected'));
        document.getElementById('slot1').textContent = '?';
        document.getElementById('slot1').classList.remove('filled');
        document.getElementById('slot2').textContent = '?';
        document.getElementById('slot2').classList.remove('filled');
        document.getElementById('slotResult').textContent = '?';
        document.getElementById('slotResult').classList.remove('filled');
        document.getElementById('mixResult').innerHTML = '';
    }

    function updateDiscCount() {
        const total = Object.keys(REACTIONS).length;
        document.getElementById('discoveriesCount').textContent = `üß™ Discoveries: ${discoveries.size} / ${total}`;
    }

    loadDiscoveries();
    renderElements();
    updateDiscCount();

    // ============================
    // SPACE EXPLORER
    // ============================
    const SPACE_FACTS = [
        { cat: 'Solar System', emoji: '‚òÄÔ∏è', title: 'The Sun', fact: 'The Sun accounts for 99.86% of the total mass of our solar system. It\'s so large that about 1.3 million Earths could fit inside it.' },
        { cat: 'Galaxies', emoji: 'üåå', title: 'The Milky Way', fact: 'Our galaxy contains 100-400 billion stars and is about 100,000 light-years across. It takes our Sun 225 million years to orbit the galactic center once.' },
        { cat: 'Planets', emoji: 'ü™ê', title: 'Saturn\'s Density', fact: 'Saturn is the least dense planet in our solar system. If you could find a bathtub big enough, Saturn would float in it.' },
        { cat: 'Deep Space', emoji: 'üï≥Ô∏è', title: 'Black Holes', fact: 'At the center of most galaxies lies a supermassive black hole. The one in our Milky Way, Sagittarius A*, has a mass 4 million times that of our Sun.' },
        { cat: 'Exploration', emoji: 'üöÄ', title: 'Voyager 1', fact: 'Launched in 1977, Voyager 1 is the farthest human-made object from Earth at over 24 billion km away. It still sends data back to us.' },
        { cat: 'Stars', emoji: '‚≠ê', title: 'Neutron Stars', fact: 'A teaspoon of neutron star material weighs about 6 billion tons. They can spin up to 716 times per second.' },
        { cat: 'Moons', emoji: 'üåô', title: 'Europa', fact: 'Jupiter\'s moon Europa has a subsurface ocean containing more water than all of Earth\'s oceans combined. It\'s a prime candidate for extraterrestrial life.' },
        { cat: 'Cosmology', emoji: 'üí´', title: 'Dark Energy', fact: 'About 68% of the universe is dark energy, 27% is dark matter, and only 5% is normal matter. We can\'t directly observe 95% of everything.' },
        { cat: 'Solar System', emoji: 'üî¥', title: 'Olympus Mons', fact: 'Mars has the tallest volcano in the solar system: Olympus Mons, at 21.9 km high ‚Äî nearly 3 times the height of Mount Everest.' },
        { cat: 'Stars', emoji: 'üí•', title: 'Supernovae', fact: 'When a massive star dies in a supernova, it briefly outshines its entire galaxy ‚Äî billions of stars. The explosion creates elements heavier than iron.' },
        { cat: 'Planets', emoji: 'üíé', title: 'Diamond Rain', fact: 'On Neptune and Uranus, it literally rains diamonds. High pressure crushes carbon in the atmosphere into diamond crystals.' },
        { cat: 'Deep Space', emoji: 'üì°', title: 'The Wow! Signal', fact: 'In 1977, a radio telescope detected a powerful 72-second signal from deep space. It\'s never been explained or repeated. We called it "Wow!"' },
        { cat: 'Cosmology', emoji: 'üåç', title: 'Pale Blue Dot', fact: 'In 1990, Voyager 1 turned around at 6 billion km and photographed Earth ‚Äî a tiny dot in a sunbeam. Carl Sagan called it our "pale blue dot."' },
        { cat: 'Exploration', emoji: 'üë®‚ÄçüöÄ', title: 'Space Smells', fact: 'Astronauts report that space smells like seared steak, gunpowder, and raspberries. The smell comes from dying stars releasing polycyclic aromatic hydrocarbons.' },
        { cat: 'Moons', emoji: 'üåï', title: 'Titan', fact: 'Saturn\'s moon Titan has lakes and seas of liquid methane and ethane. It\'s the only other body in our solar system with stable surface liquids.' },
        { cat: 'Stars', emoji: 'üåü', title: 'Magnetars', fact: 'Magnetars are neutron stars with magnetic fields a quadrillion times stronger than Earth\'s. A magnetar halfway across the galaxy could erase your credit cards.' },
    ];

    let currentFact = 0;

    function showFact(idx) {
        currentFact = ((idx % SPACE_FACTS.length) + SPACE_FACTS.length) % SPACE_FACTS.length;
        const f = SPACE_FACTS[currentFact];
        document.getElementById('spaceCategory').textContent = f.cat;
        document.getElementById('spaceEmoji').textContent = f.emoji;
        document.getElementById('spaceTitle').textContent = f.title;
        document.getElementById('spaceFact').textContent = f.fact;
    }
    function nextFact() { showFact(currentFact + 1); }
    function prevFact() { showFact(currentFact - 1); }
    function randomFact() { showFact(Math.floor(Math.random() * SPACE_FACTS.length)); }
    showFact(Math.floor(Math.random() * SPACE_FACTS.length));

    // ============================
    // LAB NOTES
    // ============================
    const NOTES_KEY = 'aetherium_lab_notes';
    const TAG_LABELS = { discovery: 'üîç Discovery', theory: 'üí° Theory', experiment: 'üß™ Experiment', observation: 'üëÅÔ∏è Observation', question: '‚ùì Question' };

    function getNotes() { try { return JSON.parse(localStorage.getItem(NOTES_KEY) || '[]'); } catch(e) { return []; } }
    function saveNotes(n) { localStorage.setItem(NOTES_KEY, JSON.stringify(n)); }

    function submitNote() {
        const author = document.getElementById('noteAuthor').value.trim() || 'Anonymous';
        const text = document.getElementById('noteText').value.trim();
        const tag = document.getElementById('noteTag').value;
        if (!text) return;

        const notes = getNotes();
        notes.unshift({ author, text, tag, time: Date.now() });
        if (notes.length > 50) notes.length = 50;
        saveNotes(notes);
        document.getElementById('noteText').value = '';
        renderNotes();
    }

    function renderNotes() {
        const notes = getNotes();
        const list = document.getElementById('notesList');
        if (!notes.length) {
            list.innerHTML = '<p style="color:var(--text-dim);text-align:center;padding:2rem;">No lab notes yet. Document your first experiment!</p>';
            return;
        }
        list.innerHTML = notes.slice(0, 25).map(n => `
            <div class="note-item">
                <span class="note-author">${esc(n.author)}</span>
                <span class="note-time">${timeAgo(n.time)}</span>
                <div class="note-text">${esc(n.text)}</div>
                <span class="note-tag">${TAG_LABELS[n.tag] || n.tag}</span>
            </div>
        `).join('');
    }

    function esc(s) { const d = document.createElement('div'); d.textContent = s; return d.innerHTML; }
    function timeAgo(ts) {
        const diff = Date.now() - ts;
        if (diff < 60000) return 'just now';
        if (diff < 3600000) return Math.floor(diff/60000) + 'm ago';
        if (diff < 86400000) return Math.floor(diff/3600000) + 'h ago';
        return Math.floor(diff/86400000) + 'd ago';
    }

    renderNotes();
    </script>

    <script src="/js/page-transitions.js?v=1"></script>
</body>
</html>
