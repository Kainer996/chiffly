<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChiffTown ‚Äî Your Virtual Town</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700;900&family=Inter:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="preload" href="/images/chifftown-map-wide.png" as="image">
    <link rel="stylesheet" href="main-home-styles.css?v=26">
    <link rel="stylesheet" href="css/town-buildings.css?v=1">
    <link rel="stylesheet" href="css/town-animations.css?v=1">
    <link rel="stylesheet" href="css/mobile-map.css?v=2">
    <link rel="stylesheet" href="css/mobile-fullscreen.css?v=1">
    <link rel="stylesheet" href="css/weather-system.css?v=1">
    <link rel="stylesheet" href="css/daily-challenges.css?v=1">
    <link rel="stylesheet" href="css/generation-system.css?v=1">
    <link rel="stylesheet" href="css/unlock-preview.css?v=1">
    <link rel="stylesheet" href="css/social-sidebar.css?v=1">
    <link rel="stylesheet" href="css/loading-screen.css?v=1">
    <link rel="stylesheet" href="css/activity-feed.css?v=1">
    <link rel="stylesheet" href="css/profile-system.css?v=1">
    <link rel="stylesheet" href="css/shop-system.css?v=1">
    <link rel="stylesheet" href="css/achievements.css?v=1">
</head>
<body>
    <!-- Ambient particles canvas -->
    <canvas id="particleCanvas"></canvas>

    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="/" class="nav-logo">
                <span style="font-family: 'Playfair Display', serif; font-size: 1.4rem; font-weight: 700; color: #c9a84c; letter-spacing: 2px; text-transform: uppercase;">Chifftown</span>
            </a>
            <div class="nav-right">
                <div class="nav-links">
                    <a href="#venues" class="nav-link">Venues</a>
                    <a href="#features" class="nav-link">Features</a>
                    <a href="achievements.html" class="nav-link"><i class="fas fa-trophy" style="margin-right: 4px;"></i> Achievements</a>
                    <a href="challenges.html" class="nav-link"><i class="fas fa-tasks" style="margin-right: 4px;"></i> Challenges</a>
                    <a href="newspaper.html" class="nav-link"><img src="/images/buildings/newspaper-icon.png?v=1770906861" alt="News" style="width: 20px; height: auto; vertical-align: middle; margin-right: 4px;"> News</a>
                    <a href="#about" class="nav-link">About</a>
                </div>
                <div class="auth-section">
                    <button class="enter-btn" id="signInBtn">
                        <span class="enter-btn-glow"></span>
                        <i class="fas fa-door-open"></i>
                        <span>Enter Town</span>
                    </button>
                    <div class="user-menu" id="userMenu" style="display: none;">
                        <div class="user-info">
                            <div class="user-avatar">
                                <i class="fas fa-user-circle"></i>
                            </div>
                            <div class="user-details">
                                <span class="user-name" id="userName">Guest User</span>
                                <span class="user-status">Online</span>
                            </div>
                        </div>
                        <div class="menu-divider"></div>
                        <a href="#" class="menu-item" onclick="if(window.ProfileSystem)ProfileSystem.openProfile()">
                            <i class="fas fa-user-cog"></i>
                            Profile Settings
                        </a>
                        <a href="#" class="menu-item" onclick="if(window.ShopSystem)ShopSystem.openShop()">
                            <i class="fas fa-store"></i>
                            Marketplace
                        </a>
                        <a href="#" class="menu-item" onclick="if(window.AchievementsSystem)AchievementsSystem.open()">
                            <i class="fas fa-trophy"></i>
                            Trophy Case
                        </a>
                        <a href="#" class="menu-item">
                            <i class="fas fa-bell"></i>
                            Notifications
                        </a>
                        <a href="#" class="menu-item">
                            <i class="fas fa-heart"></i>
                            Favorites
                        </a>
                        <div class="menu-divider"></div>
                        <a href="#" class="menu-item sign-out" id="signOutBtn">
                            <i class="fas fa-door-closed"></i>
                            Leave Town
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Town Events Banner -->
    <div id="eventsBanner" class="events-banner" style="display: none;">
        <div class="events-ticker">
            <i class="fas fa-calendar-star"></i>
            <span id="eventText">No events currently</span>
        </div>
    </div>

    <!-- Hero Section ‚Äî Town Centre -->
    <section class="hero">
        <div class="hero-map-bg"></div>
        <div class="hero-skyline" style="display:none;">
            <!-- SVG Town Silhouette -->
            <svg class="town-silhouette" viewBox="0 0 1440 400" preserveAspectRatio="none" xmlns="http://www.w3.org/2000/svg">
                <!-- Buildings -->
                <rect x="50" y="180" width="60" height="220" fill="rgba(15,10,30,0.9)"/>
                <rect x="55" y="170" width="50" height="10" fill="rgba(15,10,30,0.9)"/>
                <rect x="120" y="220" width="80" height="180" fill="rgba(20,15,35,0.85)"/>
                <rect x="210" y="160" width="50" height="240" fill="rgba(15,10,30,0.9)"/>
                <polygon points="210,160 235,130 260,160" fill="rgba(15,10,30,0.9)"/>
                <rect x="270" y="240" width="70" height="160" fill="rgba(20,15,35,0.85)"/>
                <rect x="350" y="200" width="90" height="200" fill="rgba(15,10,30,0.9)"/>
                <rect x="380" y="185" width="30" height="15" fill="rgba(15,10,30,0.9)"/>
                <rect x="450" y="250" width="60" height="150" fill="rgba(20,15,35,0.85)"/>
                <rect x="520" y="190" width="100" height="210" fill="rgba(15,10,30,0.9)"/>
                <polygon points="520,190 570,140 620,190" fill="rgba(15,10,30,0.9)"/>
                <rect x="630" y="230" width="80" height="170" fill="rgba(20,15,35,0.85)"/>
                <rect x="720" y="170" width="60" height="230" fill="rgba(15,10,30,0.9)"/>
                <rect x="735" y="155" width="30" height="15" fill="rgba(15,10,30,0.9)"/>
                <rect x="790" y="210" width="90" height="190" fill="rgba(20,15,35,0.85)"/>
                <rect x="890" y="250" width="70" height="150" fill="rgba(15,10,30,0.9)"/>
                <rect x="970" y="180" width="80" height="220" fill="rgba(20,15,35,0.85)"/>
                <polygon points="970,180 1010,145 1050,180" fill="rgba(20,15,35,0.85)"/>
                <rect x="1060" y="220" width="60" height="180" fill="rgba(15,10,30,0.9)"/>
                <rect x="1130" y="200" width="100" height="200" fill="rgba(20,15,35,0.85)"/>
                <rect x="1240" y="240" width="70" height="160" fill="rgba(15,10,30,0.9)"/>
                <rect x="1320" y="190" width="80" height="210" fill="rgba(20,15,35,0.85)"/>
                <!-- Windows (animated) -->
                <rect class="window" x="70" y="200" width="8" height="10" rx="1" fill="rgba(255,200,100,0.7)"/>
                <rect class="window" x="85" y="200" width="8" height="10" rx="1" fill="rgba(255,200,100,0.5)"/>
                <rect class="window" x="70" y="230" width="8" height="10" rx="1" fill="rgba(255,200,100,0.6)"/>
                <rect class="window" x="85" y="230" width="8" height="10" rx="1" fill="rgba(255,200,100,0.8)"/>
                <rect class="window" x="70" y="260" width="8" height="10" rx="1" fill="rgba(255,200,100,0.3)"/>
                <rect class="window" x="85" y="260" width="8" height="10" rx="1" fill="rgba(255,200,100,0.4)"/>
                <rect class="window" x="140" y="240" width="10" height="12" rx="1" fill="rgba(255,180,80,0.6)"/>
                <rect class="window" x="160" y="240" width="10" height="12" rx="1" fill="rgba(255,180,80,0.7)"/>
                <rect class="window" x="180" y="240" width="10" height="12" rx="1" fill="rgba(255,180,80,0.3)"/>
                <rect class="window" x="140" y="270" width="10" height="12" rx="1" fill="rgba(255,180,80,0.5)"/>
                <rect class="window" x="160" y="270" width="10" height="12" rx="1" fill="rgba(255,180,80,0.8)"/>
                <rect class="window" x="180" y="270" width="10" height="12" rx="1" fill="rgba(255,180,80,0.4)"/>
                <rect class="window" x="140" y="300" width="10" height="12" rx="1" fill="rgba(255,180,80,0.6)"/>
                <rect class="window" x="160" y="300" width="10" height="12" rx="1" fill="rgba(255,180,80,0.3)"/>
                <rect class="window" x="225" y="180" width="8" height="10" rx="1" fill="rgba(200,220,255,0.6)"/>
                <rect class="window" x="240" y="180" width="8" height="10" rx="1" fill="rgba(200,220,255,0.5)"/>
                <rect class="window" x="225" y="210" width="8" height="10" rx="1" fill="rgba(255,200,100,0.7)"/>
                <rect class="window" x="240" y="210" width="8" height="10" rx="1" fill="rgba(200,220,255,0.4)"/>
                <rect class="window" x="225" y="240" width="8" height="10" rx="1" fill="rgba(255,200,100,0.3)"/>
                <rect class="window" x="240" y="240" width="8" height="10" rx="1" fill="rgba(200,220,255,0.5)"/>
                <rect class="window" x="285" y="260" width="10" height="12" rx="1" fill="rgba(255,200,100,0.5)"/>
                <rect class="window" x="305" y="260" width="10" height="12" rx="1" fill="rgba(255,200,100,0.4)"/>
                <rect class="window" x="285" y="290" width="10" height="12" rx="1" fill="rgba(255,200,100,0.6)"/>
                <rect class="window" x="305" y="290" width="10" height="12" rx="1" fill="rgba(255,200,100,0.3)"/>
                <rect class="window" x="370" y="220" width="10" height="12" rx="1" fill="rgba(255,100,150,0.6)"/>
                <rect class="window" x="390" y="220" width="10" height="12" rx="1" fill="rgba(100,200,255,0.6)"/>
                <rect class="window" x="410" y="220" width="10" height="12" rx="1" fill="rgba(255,100,200,0.7)"/>
                <rect class="window" x="370" y="250" width="10" height="12" rx="1" fill="rgba(100,255,200,0.5)"/>
                <rect class="window" x="390" y="250" width="10" height="12" rx="1" fill="rgba(255,150,100,0.4)"/>
                <rect class="window" x="410" y="250" width="10" height="12" rx="1" fill="rgba(100,200,255,0.5)"/>
                <rect class="window" x="370" y="280" width="10" height="12" rx="1" fill="rgba(255,200,100,0.3)"/>
                <rect class="window" x="390" y="280" width="10" height="12" rx="1" fill="rgba(100,255,200,0.6)"/>
                <rect class="window" x="465" y="265" width="8" height="10" rx="1" fill="rgba(255,200,100,0.5)"/>
                <rect class="window" x="480" y="265" width="8" height="10" rx="1" fill="rgba(255,200,100,0.4)"/>
                <rect class="window" x="465" y="295" width="8" height="10" rx="1" fill="rgba(255,200,100,0.6)"/>
                <rect class="window" x="480" y="295" width="8" height="10" rx="1" fill="rgba(255,200,100,0.3)"/>
                <rect class="window" x="540" y="210" width="10" height="12" rx="1" fill="rgba(255,200,100,0.7)"/>
                <rect class="window" x="560" y="210" width="10" height="12" rx="1" fill="rgba(255,200,100,0.5)"/>
                <rect class="window" x="580" y="210" width="10" height="12" rx="1" fill="rgba(255,200,100,0.8)"/>
                <rect class="window" x="540" y="240" width="10" height="12" rx="1" fill="rgba(255,200,100,0.6)"/>
                <rect class="window" x="560" y="240" width="10" height="12" rx="1" fill="rgba(255,200,100,0.4)"/>
                <rect class="window" x="580" y="240" width="10" height="12" rx="1" fill="rgba(255,200,100,0.7)"/>
                <rect class="window" x="540" y="270" width="10" height="12" rx="1" fill="rgba(255,200,100,0.3)"/>
                <rect class="window" x="560" y="270" width="10" height="12" rx="1" fill="rgba(255,200,100,0.5)"/>
                <rect class="window" x="580" y="270" width="10" height="12" rx="1" fill="rgba(255,200,100,0.4)"/>
                <rect class="window" x="645" y="245" width="10" height="12" rx="1" fill="rgba(255,200,100,0.5)"/>
                <rect class="window" x="665" y="245" width="10" height="12" rx="1" fill="rgba(200,220,255,0.6)"/>
                <rect class="window" x="685" y="245" width="10" height="12" rx="1" fill="rgba(255,200,100,0.4)"/>
                <rect class="window" x="645" y="275" width="10" height="12" rx="1" fill="rgba(255,200,100,0.6)"/>
                <rect class="window" x="665" y="275" width="10" height="12" rx="1" fill="rgba(200,220,255,0.3)"/>
                <rect class="window" x="685" y="275" width="10" height="12" rx="1" fill="rgba(255,200,100,0.5)"/>
                <rect class="window" x="740" y="190" width="8" height="10" rx="1" fill="rgba(200,200,255,0.6)"/>
                <rect class="window" x="740" y="220" width="8" height="10" rx="1" fill="rgba(255,200,100,0.7)"/>
                <rect class="window" x="740" y="250" width="8" height="10" rx="1" fill="rgba(200,200,255,0.4)"/>
                <rect class="window" x="755" y="190" width="8" height="10" rx="1" fill="rgba(255,200,100,0.5)"/>
                <rect class="window" x="755" y="220" width="8" height="10" rx="1" fill="rgba(200,200,255,0.3)"/>
                <rect class="window" x="810" y="230" width="10" height="12" rx="1" fill="rgba(255,200,100,0.6)"/>
                <rect class="window" x="840" y="230" width="10" height="12" rx="1" fill="rgba(255,200,100,0.5)"/>
                <rect class="window" x="860" y="230" width="10" height="12" rx="1" fill="rgba(255,200,100,0.4)"/>
                <rect class="window" x="810" y="260" width="10" height="12" rx="1" fill="rgba(255,200,100,0.8)"/>
                <rect class="window" x="840" y="260" width="10" height="12" rx="1" fill="rgba(255,200,100,0.3)"/>
                <rect class="window" x="860" y="260" width="10" height="12" rx="1" fill="rgba(255,200,100,0.5)"/>
                <rect class="window" x="810" y="290" width="10" height="12" rx="1" fill="rgba(255,200,100,0.4)"/>
                <rect class="window" x="840" y="290" width="10" height="12" rx="1" fill="rgba(255,200,100,0.6)"/>
                <rect class="window" x="905" y="265" width="8" height="10" rx="1" fill="rgba(255,200,100,0.5)"/>
                <rect class="window" x="920" y="265" width="8" height="10" rx="1" fill="rgba(255,200,100,0.4)"/>
                <rect class="window" x="935" y="265" width="8" height="10" rx="1" fill="rgba(255,200,100,0.6)"/>
                <rect class="window" x="905" y="295" width="8" height="10" rx="1" fill="rgba(255,200,100,0.3)"/>
                <rect class="window" x="920" y="295" width="8" height="10" rx="1" fill="rgba(255,200,100,0.5)"/>
                <rect class="window" x="990" y="200" width="10" height="12" rx="1" fill="rgba(255,200,100,0.6)"/>
                <rect class="window" x="1010" y="200" width="10" height="12" rx="1" fill="rgba(200,220,255,0.5)"/>
                <rect class="window" x="1030" y="200" width="10" height="12" rx="1" fill="rgba(255,200,100,0.4)"/>
                <rect class="window" x="990" y="230" width="10" height="12" rx="1" fill="rgba(200,220,255,0.4)"/>
                <rect class="window" x="1010" y="230" width="10" height="12" rx="1" fill="rgba(255,200,100,0.6)"/>
                <rect class="window" x="1030" y="230" width="10" height="12" rx="1" fill="rgba(200,220,255,0.5)"/>
                <rect class="window" x="1075" y="240" width="8" height="10" rx="1" fill="rgba(255,200,100,0.5)"/>
                <rect class="window" x="1090" y="240" width="8" height="10" rx="1" fill="rgba(255,200,100,0.4)"/>
                <rect class="window" x="1075" y="270" width="8" height="10" rx="1" fill="rgba(255,200,100,0.6)"/>
                <rect class="window" x="1090" y="270" width="8" height="10" rx="1" fill="rgba(255,200,100,0.3)"/>
                <rect class="window" x="1150" y="220" width="10" height="12" rx="1" fill="rgba(255,200,100,0.7)"/>
                <rect class="window" x="1175" y="220" width="10" height="12" rx="1" fill="rgba(255,200,100,0.5)"/>
                <rect class="window" x="1200" y="220" width="10" height="12" rx="1" fill="rgba(255,200,100,0.4)"/>
                <rect class="window" x="1150" y="250" width="10" height="12" rx="1" fill="rgba(255,200,100,0.6)"/>
                <rect class="window" x="1175" y="250" width="10" height="12" rx="1" fill="rgba(255,200,100,0.3)"/>
                <rect class="window" x="1200" y="250" width="10" height="12" rx="1" fill="rgba(255,200,100,0.5)"/>
                <rect class="window" x="1150" y="280" width="10" height="12" rx="1" fill="rgba(255,200,100,0.4)"/>
                <rect class="window" x="1175" y="280" width="10" height="12" rx="1" fill="rgba(255,200,100,0.6)"/>
                <rect class="window" x="1255" y="255" width="8" height="10" rx="1" fill="rgba(255,200,100,0.5)"/>
                <rect class="window" x="1270" y="255" width="8" height="10" rx="1" fill="rgba(255,200,100,0.4)"/>
                <rect class="window" x="1285" y="255" width="8" height="10" rx="1" fill="rgba(255,200,100,0.6)"/>
                <rect class="window" x="1255" y="285" width="8" height="10" rx="1" fill="rgba(255,200,100,0.3)"/>
                <rect class="window" x="1270" y="285" width="8" height="10" rx="1" fill="rgba(255,200,100,0.5)"/>
                <rect class="window" x="1340" y="210" width="10" height="12" rx="1" fill="rgba(255,180,80,0.7)"/>
                <rect class="window" x="1365" y="210" width="10" height="12" rx="1" fill="rgba(255,180,80,0.5)"/>
                <rect class="window" x="1340" y="240" width="10" height="12" rx="1" fill="rgba(255,180,80,0.4)"/>
                <rect class="window" x="1365" y="240" width="10" height="12" rx="1" fill="rgba(255,180,80,0.6)"/>
                <rect class="window" x="1340" y="270" width="10" height="12" rx="1" fill="rgba(255,180,80,0.5)"/>
                <rect class="window" x="1365" y="270" width="10" height="12" rx="1" fill="rgba(255,180,80,0.3)"/>
                <!-- Street level line -->
                <rect x="0" y="395" width="1440" height="5" fill="rgba(30,20,50,0.95)"/>
            </svg>
        </div>
        <div class="hero-content">
            <div class="hero-badge">
                <i class="fas fa-star"></i>
                <span>Welcome to the Town</span>
            </div>
            <h1 class="hero-title">
                <span class="title-line">Welcome to</span>
                <span class="title-main">Chiff<span class="title-accent">Town</span></span>
            </h1>
            <p class="hero-subtitle">A virtual town where every venue has its own vibe. Meet up with your besties or make new friends in cozy pubs, buzzing nightclubs, chill lounges, and more ‚Äî all with live video chat.</p>
            <!-- Minimal inline stats -->
            <div class="hero-inline-stats">
                <span class="inline-stat"><span class="inline-num" id="totalUsers">0</span> online</span>
                <span class="inline-dot">¬∑</span>
                <span class="inline-stat"><span class="inline-num" id="activeRooms">0</span> rooms</span>
                <span class="inline-dot">¬∑</span>
                <span class="inline-stat"><span class="inline-num" id="liveStreams">0</span> live</span>
            </div>
            <!-- CTA Buttons -->
            <div class="hero-cta-row">
                <button class="cta-start-room" onclick="openInviteModal()">
                    <i class="fas fa-plus-circle"></i> Start a Room
                </button>
                <button class="cta-invite-friend" onclick="openInviteModal()">
                    <i class="fas fa-user-plus"></i> Invite a Friend
                </button>
            </div>
        </div>
    </section>

    <!-- Floating Invite FAB -->
    <button class="fab-invite" onclick="openInviteModal()" title="Invite a Friend">
        <i class="fas fa-plus"></i>
    </button>

    <!-- Invite Modal -->
    <div class="invite-modal-overlay" id="inviteModal" style="display:none;" onclick="if(event.target===this)closeInviteModal()">
        <div class="invite-modal">
            <button class="invite-modal-close" onclick="closeInviteModal()"><i class="fas fa-times"></i></button>
            <h2 class="invite-modal-title">Start a Room</h2>
            <p class="invite-modal-sub">Pick a venue and invite your friends</p>
            <div class="invite-venue-grid" id="inviteVenueGrid">
                <button class="invite-venue-btn selected" data-venue="pub" data-url="/pub.html" onclick="selectVenue(this)">
                    <i class="fas fa-beer-mug-empty"></i><span>Tavern</span>
                </button>
                <button class="invite-venue-btn" data-venue="nightclub" data-url="/nightclub.html" onclick="selectVenue(this)">
                    <i class="fas fa-music"></i><span>Nightclub</span>
                </button>
                <button class="invite-venue-btn" data-venue="cinema" data-url="/cinema.html" onclick="selectVenue(this)">
                    <i class="fas fa-film"></i><span>Cinema</span>
                </button>
                <button class="invite-venue-btn" data-venue="lounge" data-url="/lounge.html" onclick="selectVenue(this)">
                    <i class="fas fa-couch"></i><span>Lounge</span>
                </button>
                <button class="invite-venue-btn" data-venue="arcade" data-url="/games.html" onclick="selectVenue(this)">
                    <i class="fas fa-gamepad"></i><span>Arcade</span>
                </button>
                <button class="invite-venue-btn" data-venue="casino" data-url="/casino.html" onclick="selectVenue(this)">
                    <i class="fas fa-dice"></i><span>Casino</span>
                </button>
            </div>
            <div class="invite-link-section">
                <label class="invite-link-label">Your invite link</label>
                <div class="invite-link-row">
                    <input type="text" class="invite-link-input" id="inviteLinkInput" readonly>
                    <button class="invite-copy-btn" onclick="copyInviteLink()"><i class="fas fa-copy"></i> Copy</button>
                </div>
            </div>
            <button class="invite-go-btn" id="goToRoomBtn" onclick="goToRoom()">
                <i class="fas fa-door-open"></i> Enter Room
            </button>
            <div class="invite-share-row">
                <a class="invite-share-btn whatsapp" id="shareWhatsApp" href="#" target="_blank">
                    <i class="fab fa-whatsapp"></i> WhatsApp
                </a>
                <a class="invite-share-btn sms" id="shareSMS" href="#">
                    <i class="fas fa-comment-sms"></i> Text
                </a>
                <button class="invite-share-btn native" onclick="nativeShare()">
                    <i class="fas fa-share-nodes"></i> Share
                </button>
            </div>
        </div>
    </div>

    <!-- Venues Section ‚Äî Town Map -->
    <section id="venues" class="venues-section">
        <div class="container">
            <div class="map-controls">
                <button class="fullscreen-btn" onclick="toggleMapFullscreen()" title="Explore Chifftown">
                    <i class="fas fa-expand"></i> Explore Full Screen
                </button>
            </div>
            
            <div class="interactive-map-container" id="mapContainer">
                <!-- Fullscreen HUD -->
                <div class="fs-hud" id="fsHud">
                    <div class="hud-left">
                        <div class="hud-avatar" id="hudAvatar"><i class="fas fa-user"></i></div>
                        <div class="hud-info">
                            <div class="hud-username" id="hudUsername">Guest</div>
                            <div class="hud-xp-bar">
                                <div class="hud-xp-fill" id="hudXpFill" style="width: 35%"></div>
                            </div>
                            <div class="hud-xp-text"><span id="hudLevel">Lvl 1</span> ¬∑ <span id="hudXp">350</span>/<span id="hudXpMax">1000</span> XP</div>
                        </div>
                    </div>
                    <div class="hud-right">
                        <div class="hud-currency clickable" onclick="if(window.ShopSystem)ShopSystem.openShop()" title="Open Marketplace">
                            <span class="hud-coin">ü™ô</span>
                            <span class="hud-coin-amount" id="hudCoins">250</span>
                        </div>
                        <div class="hud-currency hud-gems">
                            <span class="hud-gem">üíé</span>
                            <span class="hud-gem-amount" id="hudGems">5</span>
                        </div>
                        <button class="fs-exit-btn" id="editModeBtn" onclick="toggleEdit()" title="Rearrange Town"><i class="fas fa-arrows-alt"></i></button>
                        <button class="fs-exit-btn" onclick="toggleMapFullscreen()"><i class="fas fa-compress"></i></button>
                    </div>
                </div>
                
                <!-- Daily Challenges Widget -->
                <div class="challenges-widget" id="challengesWidget">
                    <div class="challenges-widget-header">
                        <span class="challenges-widget-title">üéØ Daily Challenges</span>
                        <a href="challenges.html" class="challenges-widget-link">View All</a>
                    </div>
                    <div id="challengesList" class="challenges-list">
                        <!-- Challenges will be populated by JS -->
                        <div class="challenge-mini-loading">
                            <i class="fas fa-spinner fa-spin"></i> Loading challenges...
                        </div>
                    </div>
                </div>
                
                <div class="edit-toolbar" id="editToolbar">
                    <span class="edit-label">‚úèÔ∏è Edit Mode</span>
                    <button onclick="TownEngine.resetLayout()">Reset</button>
                    <button class="save-btn" onclick="toggleEdit()">‚úì Done</button>
                </div>
                <img src="/images/chifftown-map-wide.png" alt="Chifftown City Map" class="city-map-image">
                <!-- Hotspot Overlays (until isometric sprites are ready) -->
                <a href="/questing.html" class="map-hotspot adventure-hotspot" data-venue="Adventure Guild">
                    <div class="hotspot-glow"></div>
                    <div class="hotspot-label">Adventure Guild</div>
                </a>
                
                <a href="/pub.html" class="map-hotspot tavern-hotspot" data-venue="The Chiff Inn">
                    <div class="hotspot-glow"></div>
                    <div class="hotspot-label">The Chiff Inn</div>
                </a>
                
                <a href="/nightclub.html" class="map-hotspot nightclub-hotspot" data-venue="Neon Pulse">
                    <div class="hotspot-glow"></div>
                    <div class="hotspot-label">Neon Pulse</div>
                </a>
                
                <a href="/cinema.html" class="map-hotspot cinema-hotspot" data-venue="Starlight Cinema">
                    <div class="hotspot-glow"></div>
                    <div class="hotspot-label">Starlight Cinema</div>
                </a>
                
                <a href="/games.html" class="map-hotspot arcade-hotspot" data-venue="Pixel Palace">
                    <div class="hotspot-glow"></div>
                    <div class="hotspot-label">Pixel Palace</div>
                </a>
                
                <a href="/lounge.html" class="map-hotspot lounge-hotspot" data-venue="Velvet Sky">
                    <div class="hotspot-glow"></div>
                    <div class="hotspot-label">Velvet Sky</div>
                </a>
                
                <a href="https://goodnews-24.com" target="_blank" class="map-hotspot billboard-hotspot" data-venue="Good News 24">
                    <div class="hotspot-glow"></div>
                    <div class="hotspot-label">Good News 24</div>
                </a>
                
                <a href="/wellness.html" class="map-hotspot wellness-hotspot" data-venue="The Wellness Centre">
                    <div class="hotspot-glow"></div>
                    <div class="hotspot-label">üßò Wellness Centre</div>
                </a>
                
                <a href="/apartment.html" class="map-hotspot apartment-hotspot" data-venue="Your Apartment">
                    <div class="hotspot-glow"></div>
                    <div class="hotspot-label">üè† Your Apartment</div>
                </a>
                
                <a href="/casino.html" class="map-hotspot casino-hotspot" data-venue="The Golden Dice">
                    <div class="hotspot-glow"></div>
                    <div class="hotspot-label">üé∞ Casino</div>
                </a>

                <!-- Gen 4 Hotspots -->
                <a href="/observatory.html" class="map-hotspot hotspot-observatory" data-building="observatory" data-tooltip="Starfire Observatory">
                    <div class="hotspot-glow"></div>
                    <div class="hotspot-label">Starfire Observatory</div>
                </a>
                <a href="/chronos.html" class="map-hotspot hotspot-chronos" data-building="chronos" data-tooltip="The Chronos Club">
                    <div class="hotspot-glow"></div>
                    <div class="hotspot-label">The Chronos Club</div>
                </a>
                <a href="/aetherium.html" class="map-hotspot hotspot-aetherium" data-building="aetherium" data-tooltip="The Aetherium Lab">
                    <div class="hotspot-glow"></div>
                    <div class="hotspot-label">The Aetherium Lab</div>
                </a>
                <a href="/hall-of-fame" class="map-hotspot hotspot-hall-of-fame" data-building="halloffame" data-tooltip="Hall of Fame">
                    <div class="hotspot-glow"></div>
                    <div class="hotspot-label">üèÜ Hall of Fame</div>
                </a>
            </div>
            <!-- Venue Quick List -->
            <div class="venue-list">
                <a href="/pub.html" class="venue-item">
                    <span class="venue-icon"><img src="/images/buildings/tavern.png?v=1770903060" alt="Tavern" style="width: 95px; height: auto;"></span>
                    <span class="venue-name">The Chiff Inn</span>
                    <span class="venue-desc">Cozy pub vibes</span>
                </a>
                <a href="/nightclub.html" class="venue-item">
                    <span class="venue-icon"><img src="/images/buildings/nightclub.png?v=1770903060" alt="Nightclub" style="width: 95px; height: auto;"></span>
                    <span class="venue-name">Neon Pulse</span>
                    <span class="venue-desc">Dance & party</span>
                </a>
                <a href="/newspaper.html" class="venue-item">
                    <span class="venue-icon"><img src="/images/buildings/newspaper-icon.png?v=1770906861" alt="Newspaper" style="width: 95px; height: auto;"></span>
                    <span class="venue-name">The Chronicle</span>
                    <span class="venue-desc">Town newspaper</span>
                </a>
                <a href="/cinema.html" class="venue-item">
                    <span class="venue-icon"><img src="/images/buildings/cinema.png?v=1770903060" alt="Cinema" style="width: 95px; height: auto;"></span>
                    <span class="venue-name">Starlight Cinema</span>
                    <span class="venue-desc">Watch together</span>
                </a>
                <a href="/games.html" class="venue-item">
                    <span class="venue-icon"><img src="/images/buildings/arcade.png?v=1770903060" alt="Arcade" style="width: 95px; height: auto;"></span>
                    <span class="venue-name">Pixel Palace</span>
                    <span class="venue-desc">Retro arcade</span>
                </a>
                <a href="/lounge.html" class="venue-item">
                    <span class="venue-icon"><img src="/images/buildings/lounge.png?v=1770903060" alt="Lounge" style="width: 95px; height: auto;"></span>
                    <span class="venue-name">Velvet Sky</span>
                    <span class="venue-desc">Chill & chat</span>
                </a>
                <a href="/questing.html" class="venue-item">
                    <span class="venue-icon"><img src="/images/buildings/adventure.png?v=1770903060" alt="Adventure Guild" style="width: 95px; height: auto;"></span>
                    <span class="venue-name">Adventure Guild</span>
                    <span class="venue-desc">Quests & stories</span>
                </a>
                <a href="/apartment.html" class="venue-item">
                    <span class="venue-icon"><img src="/images/buildings/apartment.png?v=1770903060" alt="Apartment" style="width: 95px; height: auto;"></span>
                    <span class="venue-name">Your Apartment</span>
                    <span class="venue-desc">Your own space</span>
                </a>
                <a href="/wellness.html" class="venue-item">
                    <span class="venue-icon"><img src="/images/buildings/wellness.png?v=1770903060" alt="Wellness" style="width: 95px; height: auto;"></span>
                    <span class="venue-name">Wellness Centre</span>
                    <span class="venue-desc">Feel good science</span>
                </a>
                <a href="/casino.html" class="venue-item">
                    <span class="venue-icon"><img src="/images/buildings/casino.png?v=1770903060" alt="Casino" style="width: 95px; height: auto;"></span>
                    <span class="venue-name">The Golden Dice</span>
                    <span class="venue-desc">Test your luck</span>
                </a>
                <a href="/profile.html" class="venue-item">
                    <span class="venue-icon">üë§</span>
                    <span class="venue-name">Profile</span>
                    <span class="venue-desc">Customize you</span>
                </a>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section id="features" class="features-section">
        <div class="container">
            <div class="section-header">
                <span class="section-badge"><i class="fas fa-sparkles"></i> What's Inside</span>
                <h2 class="section-title">Built for Hanging Out</h2>
                <p class="section-desc">Real connections, not just another video call.</p>
            </div>
            <div class="features-grid">
                <div class="feature-card">
                    <h3>Live Video Chat</h3>
                    <p>WebRTC-powered face-to-face conversations with crystal-clear quality.</p>
                </div>
                <div class="feature-card">
                    <h3>Themed Venues</h3>
                    <p>Every room has its own atmosphere ‚Äî from cozy pubs to electric nightclubs.</p>
                </div>
                <div class="feature-card">
                    <h3>Real-time Chat</h3>
                    <p>Text chat alongside video for sharing links, reactions, and banter.</p>
                </div>
                <div class="feature-card">
                    <h3>Works Everywhere</h3>
                    <p>Desktop, mobile, tablet ‚Äî jump in from wherever you are.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section id="about" class="about-section">
        <div class="container">
            <div class="about-content">
                <div class="about-text">
                    <span class="section-badge"><i class="fas fa-info-circle"></i> About ChiffTown</span>
                    <h2>More Than Just a Video Call</h2>
                    <p>ChiffTown is a virtual town where you don't just join a meeting ‚Äî you step into a place. Each venue has its own personality, its own crowd, its own vibe. It's the feeling of walking into your local pub, hitting the club with mates, or chilling in a lounge ‚Äî but from anywhere in the world.</p>
                    <p>Built with love using WebRTC, Socket.io, and a lot of CSS magic. No downloads, no installs ‚Äî just click and you're there.</p>
                </div>
                <div class="about-visual">
                    <div class="about-card">
                        <span>6 Unique Venues</span>
                    </div>
                    <div class="about-card">
                        <span>HD Video Chat</span>
                    </div>
                    <div class="about-card">
                        <span>Instant Access</span>
                    </div>
                    <div class="about-card">
                        <span>Private Rooms</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <div class="footer-logo">
                        <i class="fas fa-city"></i>
                        <span>Chiff<span class="logo-accent">Town</span></span>
                    </div>
                    <p>Your virtual town for real connections.</p>
                    <div class="social-links">
                        <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="#" aria-label="Discord"><i class="fab fa-discord"></i></a>
                        <a href="#" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                <div class="footer-links">
                    <h4>Venues</h4>
                    <ul>
                        <li><a href="pub.html">The Chiff Inn</a></li>
                        <li><a href="nightclub.html">Night Club</a></li>
                        <li><a href="cinema.html">Cinema</a></li>
                        <li><a href="games.html">Arcade</a></li>
                        <li><a href="lounge.html">Lounge</a></li>
                        <li><a href="questing.html">Adventure Guild</a></li>
                    </ul>
                </div>
                <div class="footer-links">
                    <h4>Platform</h4>
                    <ul>
                        <li><a href="#features">Features</a></li>
                        <li><a href="#about">About</a></li>
                        <li><a href="#">Privacy</a></li>
                        <li><a href="#">Terms</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 ChiffTown. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Aircraft container (for planes/helicopters flying across) -->
    <div id="aircraftLayer" style="position:fixed;top:0;left:0;width:100%;height:40vh;pointer-events:none;z-index:999;overflow:hidden;"></div>

    <style>
        /* Window glow animation */
        .window {
            transition: fill 2s ease-in-out, opacity 2s ease-in-out;
        }
        .window.off {
            fill: rgba(20,15,35,0.3) !important;
            opacity: 0.2;
        }
        .window.bright {
            filter: url(#windowGlow);
        }
        /* Aircraft styles */
        .aircraft {
            position: absolute;
            opacity: 0.7;
        }
        .aircraft-light {
            width: 3px;
            height: 3px;
            border-radius: 50%;
            background: #fff;
            position: absolute;
            animation: blink 1.5s ease-in-out infinite;
        }
        .aircraft-light.red {
            background: #ff3333;
            animation: blink 1s ease-in-out infinite;
        }
        .aircraft-light.green {
            background: #33ff33;
            animation: blink 1.2s ease-in-out infinite 0.5s;
        }
        .aircraft-body {
            width: 6px;
            height: 2px;
            background: rgba(180,180,200,0.3);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.1; }
        }
        @keyframes flyRight {
            from { transform: translateX(-50px); }
            to { transform: translateX(calc(100vw + 50px)); }
        }
        @keyframes flyLeft {
            from { transform: translateX(calc(100vw + 50px)); }
            to { transform: translateX(-50px); }
        }
    </style>

    <style>
    /* === CTA Buttons in Hero === */
    .hero-cta-row { display: flex; gap: 14px; margin-top: 28px; justify-content: center; flex-wrap: wrap; }
    .cta-start-room, .cta-invite-friend {
        font-family: 'Inter', sans-serif; font-weight: 600; font-size: 1rem;
        border: none; border-radius: 12px; padding: 14px 28px; cursor: pointer;
        display: inline-flex; align-items: center; gap: 8px; transition: all 0.3s ease;
        letter-spacing: 0.5px;
    }
    .cta-start-room {
        background: linear-gradient(135deg, #c9a84c 0%, #e0c068 100%);
        color: #0a0a1a; box-shadow: 0 4px 24px rgba(201,168,76,0.35);
    }
    .cta-start-room:hover { transform: translateY(-2px); box-shadow: 0 6px 32px rgba(201,168,76,0.5); }
    .cta-invite-friend {
        background: linear-gradient(135deg, #2a9d8f 0%, #3ab8a8 100%);
        color: #fff; box-shadow: 0 4px 24px rgba(42,157,143,0.3);
    }
    .cta-invite-friend:hover { transform: translateY(-2px); box-shadow: 0 6px 32px rgba(42,157,143,0.45); }

    /* === Floating FAB === */
    .fab-invite {
        position: fixed; bottom: 28px; right: 28px; z-index: 9000;
        width: 58px; height: 58px; border-radius: 50%; border: none; cursor: pointer;
        background: linear-gradient(135deg, #c9a84c 0%, #e0c068 100%);
        color: #0a0a1a; font-size: 1.5rem;
        box-shadow: 0 4px 20px rgba(201,168,76,0.4);
        transition: all 0.3s ease;
        display: flex; align-items: center; justify-content: center;
    }
    .fab-invite:hover { transform: scale(1.1) rotate(90deg); box-shadow: 0 6px 28px rgba(201,168,76,0.6); }

    /* === Invite Modal === */
    .invite-modal-overlay {
        position: fixed; inset: 0; z-index: 10000;
        background: rgba(0,0,0,0.7); backdrop-filter: blur(6px);
        display: flex; align-items: center; justify-content: center; padding: 20px;
    }
    .invite-modal {
        background: linear-gradient(170deg, #0f1a2e 0%, #0a0f1e 100%);
        border: 1px solid rgba(201,168,76,0.2); border-radius: 20px;
        padding: 36px 32px; max-width: 480px; width: 100%; position: relative;
        box-shadow: 0 20px 60px rgba(0,0,0,0.6);
        animation: modalIn 0.3s ease;
    }
    @keyframes modalIn { from { opacity:0; transform: scale(0.92) translateY(20px); } to { opacity:1; transform: scale(1) translateY(0); } }
    .invite-modal-close {
        position: absolute; top: 14px; right: 16px; background: none; border: none;
        color: rgba(255,255,255,0.4); font-size: 1.2rem; cursor: pointer; transition: color 0.2s;
    }
    .invite-modal-close:hover { color: #fff; }
    .invite-modal-title {
        font-family: 'Playfair Display', serif; font-size: 1.6rem; font-weight: 700;
        color: #c9a84c; margin: 0 0 4px; text-align: center;
    }
    .invite-modal-sub {
        font-family: 'Inter', sans-serif; color: rgba(255,255,255,0.5);
        font-size: 0.9rem; text-align: center; margin: 0 0 24px;
    }
    .invite-venue-grid {
        display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 24px;
    }
    .invite-venue-btn {
        background: rgba(255,255,255,0.04); border: 1px solid rgba(255,255,255,0.08);
        border-radius: 12px; padding: 14px 8px; cursor: pointer; transition: all 0.2s;
        display: flex; flex-direction: column; align-items: center; gap: 6px;
        color: rgba(255,255,255,0.6); font-family: 'Inter', sans-serif; font-size: 0.8rem;
    }
    .invite-venue-btn i { font-size: 1.3rem; }
    .invite-venue-btn:hover { background: rgba(42,157,143,0.1); border-color: rgba(42,157,143,0.3); color: #fff; }
    .invite-venue-btn.selected {
        background: rgba(201,168,76,0.12); border-color: rgba(201,168,76,0.5);
        color: #c9a84c;
    }
    .invite-link-section { margin-bottom: 20px; }
    .invite-link-label { font-family: 'Inter', sans-serif; font-size: 0.8rem; color: rgba(255,255,255,0.4); margin-bottom: 8px; display: block; }
    .invite-link-row { display: flex; gap: 8px; }
    .invite-link-input {
        flex: 1; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.1);
        border-radius: 10px; padding: 12px 14px; color: #fff; font-family: 'Inter', sans-serif;
        font-size: 0.85rem; outline: none;
    }
    .invite-copy-btn {
        background: linear-gradient(135deg, #c9a84c, #e0c068); color: #0a0a1a;
        border: none; border-radius: 10px; padding: 12px 18px; cursor: pointer;
        font-family: 'Inter', sans-serif; font-weight: 600; font-size: 0.85rem;
        display: flex; align-items: center; gap: 6px; transition: all 0.2s; white-space: nowrap;
    }
    .invite-copy-btn:hover { transform: translateY(-1px); box-shadow: 0 4px 16px rgba(201,168,76,0.3); }
    .invite-go-btn {
        width: 100%; padding: 14px; margin-bottom: 16px; border: none; border-radius: 12px; cursor: pointer;
        background: linear-gradient(135deg, #c9a84c 0%, #e8c84a 100%); color: #0a0e1a; font-size: 1.1rem;
        font-weight: 700; font-family: 'Inter', sans-serif; letter-spacing: 0.5px;
        display: flex; align-items: center; justify-content: center; gap: 10px;
        transition: all 0.3s ease; box-shadow: 0 4px 20px rgba(201,168,76,0.4);
    }
    .invite-go-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 28px rgba(201,168,76,0.6); }
    .invite-share-row { display: flex; gap: 10px; justify-content: center; }
    .invite-share-btn {
        border: none; border-radius: 10px; padding: 10px 18px; cursor: pointer;
        font-family: 'Inter', sans-serif; font-weight: 500; font-size: 0.85rem;
        display: inline-flex; align-items: center; gap: 6px; transition: all 0.2s;
        text-decoration: none;
    }
    .invite-share-btn.whatsapp { background: #25d366; color: #fff; }
    .invite-share-btn.sms { background: #2a9d8f; color: #fff; }
    .invite-share-btn.native { background: rgba(255,255,255,0.08); color: rgba(255,255,255,0.7); border: 1px solid rgba(255,255,255,0.1); }
    .invite-share-btn:hover { transform: translateY(-1px); filter: brightness(1.1); }
    @media (max-width: 500px) {
        .invite-venue-grid { grid-template-columns: repeat(2, 1fr); }
        .invite-modal { padding: 28px 20px; }
        .hero-cta-row { flex-direction: column; align-items: center; }
        .cta-start-room, .cta-invite-friend { width: 100%; max-width: 280px; justify-content: center; }
    }
    </style>

    <!-- Scripts -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
    <script src="xp-system.js?v=1"></script>
    <script src="js/xp-client.js?v=1"></script>
    <script src="js/xp-engine.js?v=1"></script>
    <script src="js/events.js?v=1"></script>
    <script src="main-home.js?v=12"></script>
    <script src="js/live-occupancy.js?v=1"></script>
    <script src="js/interactive-map.js?v=1"></script>
    <script src="js/mobile-map.js?v=2"></script>
    <script>
    // === TOWN ALIVE ANIMATIONS ===
    (function() {
        // --- Window Light Animation ---
        const windows = document.querySelectorAll('.town-silhouette .window');
        if (windows.length) {
            // Add SVG glow filter
            const svg = document.querySelector('.town-silhouette');
            const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
            defs.innerHTML = `
                <filter id="windowGlow" x="-50%" y="-50%" width="200%" height="200%">
                    <feGaussianBlur stdDeviation="2.5" result="blur"/>
                    <feMerge>
                        <feMergeNode in="blur"/>
                        <feMergeNode in="SourceGraphic"/>
                    </feMerge>
                </filter>
            `;
            svg.insertBefore(defs, svg.firstChild);

            // Start some windows off
            windows.forEach(w => {
                if (Math.random() < 0.3) w.classList.add('off');
                if (Math.random() < 0.4) w.classList.add('bright');
            });

            // Randomly toggle windows
            function toggleWindow() {
                const w = windows[Math.floor(Math.random() * windows.length)];
                if (w.classList.contains('off')) {
                    w.classList.remove('off');
                    // Random warm color when turning on
                    const colors = [
                        'rgba(255,200,100,0.7)', 'rgba(255,180,80,0.6)', 
                        'rgba(200,220,255,0.5)', 'rgba(255,150,100,0.6)',
                        'rgba(255,220,150,0.7)', 'rgba(200,200,255,0.5)'
                    ];
                    w.setAttribute('fill', colors[Math.floor(Math.random() * colors.length)]);
                    if (Math.random() < 0.3) w.classList.add('bright');
                } else {
                    w.classList.add('off');
                    w.classList.remove('bright');
                }
                // Next toggle in 1-5 seconds
                setTimeout(toggleWindow, 1000 + Math.random() * 4000);
            }
            setTimeout(toggleWindow, 2000);
            // Run 2-3 parallel toggle chains for more life
            setTimeout(() => setTimeout(toggleWindow, 500 + Math.random() * 3000), 1000);
            setTimeout(() => setTimeout(toggleWindow, 1500 + Math.random() * 3000), 2000);
        }

        // --- Aircraft Animation ---
        const aircraftLayer = document.getElementById('aircraftLayer');
        if (!aircraftLayer) return;

        function spawnAircraft() {
            const isHelicopter = Math.random() < 0.3;
            const goesRight = Math.random() < 0.5;
            const y = 15 + Math.random() * 60; // 15-75% of the aircraft layer height
            const duration = isHelicopter ? (25 + Math.random() * 15) : (20 + Math.random() * 20); // seconds

            const el = document.createElement('div');
            el.className = 'aircraft';
            el.style.top = y + '%';

            if (isHelicopter) {
                // Helicopter: white light + red blinking
                el.innerHTML = `
                    <div class="aircraft-body" style="width:4px;height:2px;"></div>
                    <div class="aircraft-light" style="left:0;top:0;"></div>
                    <div class="aircraft-light red" style="left:6px;top:-1px;width:2px;height:2px;"></div>
                `;
            } else {

                // Plane: white + red + green wingtip lights
                el.innerHTML = `
                    <div class="aircraft-body" style="width:8px;height:2px;"></div>
                    <div class="aircraft-light" style="left:3px;top:0;"></div>
                    <div class="aircraft-light red" style="left:-2px;top:1px;width:2px;height:2px;"></div>
                    <div class="aircraft-light green" style="left:10px;top:1px;width:2px;height:2px;"></div>
                `;
            }

            el.style.animation = `${goesRight ? 'flyRight' : 'flyLeft'} ${duration}s linear forwards`;
            el.style.opacity = 0.5 + Math.random() * 0.4;
            
            aircraftLayer.appendChild(el);

            // Remove after animation
            setTimeout(() => {
                el.remove();
            }, duration * 1000 + 500);

            // Schedule next aircraft: 15-35 seconds

            setTimeout(spawnAircraft, 15000 + Math.random() * 20000);
        }

        // Start first aircraft after 3-8 seconds
        setTimeout(spawnAircraft, 3000 + Math.random() * 5000);
        // Start a second chain slightly delayed for variety
        setTimeout(spawnAircraft, 10000 + Math.random() * 10000);
    })();
    </script>
<script>
function toggleMapFullscreen() {
    const container = document.getElementById('mapContainer');
    const isFullscreen = !!(document.fullscreenElement || document.webkitFullscreenElement);
    
    if (isFullscreen) {
        // Exit fullscreen
        (document.exitFullscreen || document.webkitExitFullscreen).call(document);
    } else {
        // Enter real fullscreen
        const requestFS = container.requestFullscreen || container.webkitRequestFullscreen;
        if (requestFS) {
            requestFS.call(container).then(() => {
                container.classList.add('fullscreen-map');
                // Try landscape on mobile
                if (screen.orientation && screen.orientation.lock) {
                    screen.orientation.lock('landscape').catch(() => {});
                }
            }).catch(() => {
                // Fallback: CSS-only fullscreen for browsers that block the API
                cssFullscreen(container, true);
            });
        } else {
            // No Fullscreen API ‚Äî CSS fallback
            cssFullscreen(container, true);
        }
    }
}

function cssFullscreen(container, enter) {
    if (enter) {
        container.classList.add('fullscreen-map');
        document.body.style.overflow = 'hidden';
        const closeBtn = document.createElement('button');
        closeBtn.id = 'fsCloseBtn';
        closeBtn.className = 'fullscreen-close';
        closeBtn.innerHTML = '<i class="fas fa-compress"></i> Exit';
        closeBtn.onclick = toggleMapFullscreen;
        closeBtn.style.display = 'block';
        document.body.appendChild(closeBtn);
    } else {
        container.classList.remove('fullscreen-map');
        document.body.style.overflow = '';
        const closeBtn = document.getElementById('fsCloseBtn');
        if (closeBtn) closeBtn.remove();
    }
}

// Listen for fullscreen change to sync CSS class + cleanup
document.addEventListener('fullscreenchange', onFSChange);
document.addEventListener('webkitfullscreenchange', onFSChange);

function onFSChange() {
    const container = document.getElementById('mapContainer');
    const isFullscreen = !!(document.fullscreenElement || document.webkitFullscreenElement);
    if (isFullscreen) {
        container.classList.add('fullscreen-map');
        document.body.style.overflow = 'hidden';
    } else {
        container.classList.remove('fullscreen-map');
        document.body.style.overflow = '';
        if (screen.orientation && screen.orientation.unlock) screen.orientation.unlock();
        const closeBtn = document.getElementById('fsCloseBtn');
        if (closeBtn) closeBtn.remove();
    }
}

document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
        const container = document.getElementById('mapContainer');
        if (container.classList.contains('fullscreen-map') && !document.fullscreenElement) {
            cssFullscreen(container, false);
        }
    }
});

// === HUD Data ===
function updateHud() {
    try {
        const user = JSON.parse(localStorage.getItem('chifftown_user') || '{}');
        const stats = JSON.parse(localStorage.getItem('chifftown_stats') || '{}');
        
        if (user.username || user.displayName) {
            document.getElementById('hudUsername').textContent = user.displayName || user.username;
        }
        
        const xp = stats.xp || 350;
        const level = stats.level || Math.floor(xp / 1000) + 1;
        const xpInLevel = xp % 1000;
        const xpMax = 1000;
        const coins = stats.coins || 250;
        const gems = stats.gems || 5;
        
        document.getElementById('hudLevel').textContent = 'Lvl ' + level;
        document.getElementById('hudXp').textContent = xpInLevel;
        document.getElementById('hudXpMax').textContent = xpMax;
        document.getElementById('hudXpFill').style.width = (xpInLevel / xpMax * 100) + '%';
        document.getElementById('hudCoins').textContent = coins.toLocaleString();
        document.getElementById('hudGems').textContent = gems;
    } catch(e) {}
}
updateHud();

// === EDIT MODE ===
function toggleEdit() {
    const isEdit = TownEngine.toggleEditMode();
    const btn = document.getElementById('editModeBtn');
    const toolbar = document.getElementById('editToolbar');
    if (isEdit) {
        btn.style.background = 'rgba(42, 157, 143, 0.4)';
        btn.style.borderColor = 'rgba(42, 157, 143, 0.6)';
        toolbar.classList.add('visible');
    } else {
        btn.style.background = '';
        btn.style.borderColor = '';
        toolbar.classList.remove('visible');
    }
}
</script>
<script>
// === INVITE MODAL LOGIC ===
function generateInviteCode() {
    return Array.from(crypto.getRandomValues(new Uint8Array(4)))
        .map(b => b.toString(36)).join('').substring(0, 8).toUpperCase();
}

let currentInviteCode = generateInviteCode();
let currentVenueUrl = '/pub.html';

function getInviteLink() {
    return window.location.origin + currentVenueUrl + '?invite=' + currentInviteCode;
}

function goToRoom() {
    const link = getInviteLink();
    window.location.href = link;
}

function selectVenue(btn) {
    document.querySelectorAll('.invite-venue-btn').forEach(b => b.classList.remove('selected'));
    btn.classList.add('selected');
    currentVenueUrl = btn.dataset.url;
    currentInviteCode = generateInviteCode();
    updateInviteLink();
}

function updateInviteLink() {
    const link = getInviteLink();
    document.getElementById('inviteLinkInput').value = link;
    const msg = encodeURIComponent('Join me on ChiffTown! ' + link);
    document.getElementById('shareWhatsApp').href = 'https://wa.me/?text=' + msg;
    document.getElementById('shareSMS').href = 'sms:?body=' + msg;
}

function openInviteModal() {
    currentInviteCode = generateInviteCode();
    updateInviteLink();
    document.getElementById('inviteModal').style.display = 'flex';
}

function closeInviteModal() {
    document.getElementById('inviteModal').style.display = 'none';
}

function copyInviteLink() {
    const input = document.getElementById('inviteLinkInput');
    navigator.clipboard.writeText(input.value).then(() => {
        const btn = document.querySelector('.invite-copy-btn');
        const orig = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-check"></i> Copied!';
        setTimeout(() => btn.innerHTML = orig, 2000);
    });
}

function nativeShare() {
    if (navigator.share) {
        navigator.share({ title: 'Join me on ChiffTown!', url: getInviteLink() });
    } else {
        copyInviteLink();
    }
}

document.addEventListener('keydown', e => { if (e.key === 'Escape') closeInviteModal(); });
</script>
<script src="/js/town-engine.js?v=1"></script>
<script src="/js/weather-system.js?v=1"></script>
<script src="/js/ambient-life.js?v=1"></script>
<script src="/js/daily-challenges.js?v=1"></script>
<script src="/js/generation-system.js?v=1"></script>
<script src="/js/unlock-preview.js?v=1"></script>
<script src="/js/social-system.js?v=1"></script>
<script src="/js/loading-screen.js?v=1"></script>
<script src="/js/page-transitions.js?v=1"></script>
<script src="/js/activity-feed.js?v=1"></script>
<script src="/js/profile-system.js?v=1"></script>
<script src="/js/shop-system.js?v=1"></script>
<script src="/js/weather-events.js?v=1"></script>
<script src="/js/building-preview.js?v=1"></script>
<script src="/js/town-npcs.js?v=1"></script>
<script src="/js/achievements.js?v=1"></script>
<script src="/js/town-chat.js?v=1"></script>
<script>
    // Town engine ready but disabled until we have proper isometric sprites
    // TownEngine.init('mapContainer');
    // TODO: Generate isometric building sprites, then enable
</script>
</body>
</html>
